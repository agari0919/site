<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DX LMS ãƒ¢ãƒƒã‚¯ã‚¢ãƒƒãƒ—</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Noto Sans JP', 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .snap-x-mandatory {
            scroll-snap-type: x mandatory;
        }
        .snap-start {
            scroll-snap-align: start;
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .active-tab {
            color: #2563eb; /* text-blue-600 */
        }
        .active-tab svg {
            stroke: #2563eb;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="app-container" class="pb-20 md:pb-0">
        <!-- App pages will be rendered here -->
    </div>

    <!-- Onboarding Modal -->
    <div id="onboarding-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-xl w-full max-w-md transform transition-all duration-300 ease-out" id="onboarding-content">
            <!-- Onboarding steps will be injected here -->
        </div>
    </div>

    <!-- Bottom Tab Bar for Mobile -->
    <footer id="bottom-nav" class="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-sm border-t border-slate-200 shadow-t-md flex justify-around md:hidden z-40">
        <button data-page="home" class="nav-button flex-1 flex flex-col items-center justify-center p-2 text-slate-500 active-tab">
            <i data-lucide="home"></i>
            <span class="text-xs mt-1">ãƒ›ãƒ¼ãƒ </span>
        </button>
        <button data-page="browse" class="nav-button flex-1 flex flex-col items-center justify-center p-2 text-slate-500">
            <i data-lucide="layout-grid"></i>
            <span class="text-xs mt-1">æ¢ã™</span>
        </button>
        <button data-page="search" class="nav-button flex-1 flex flex-col items-center justify-center p-2 text-slate-500">
            <i data-lucide="search"></i>
            <span class="text-xs mt-1">æ¤œç´¢</span>
        </button>
        <button data-page="learning" class="nav-button flex-1 flex flex-col items-center justify-center p-2 text-slate-500">
            <i data-lucide="clapperboard"></i>
            <span class="text-xs mt-1">å­¦ç¿’ä¸­</span>
        </button>
        <button data-page="profile" class="nav-button flex-1 flex flex-col items-center justify-center p-2 text-slate-500">
            <i data-lucide="user"></i>
            <span class="text-xs mt-1">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</span>
        </button>
    </footer>


<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- DATA ---
    // Simulating a database of courses
    const courses = [
        { id: 1, title: "ãªãœä»ŠDXï¼Ÿ â€•çœŒå†…GDPã¨ç”Ÿç”£æ€§ãƒ‡ãƒ¼ã‚¿ã§è¦‹ã‚‹å±æ©Ÿæ„Ÿ", category: "A. DXãƒªãƒ†ãƒ©ã‚·ãƒ¼åŸºç¤", subcategory: "1. DXã®å¿…è¦æ€§ã¨æ²–ç¸„ã®ç¾çŠ¶", tags: { difficulty: "å…¥é–€", role: "çµŒå–¶è€…", time: "15åˆ†+" }, thumbnail: "https://placehold.co/600x400/0284c7/ffffff?text=DXã®å¿…è¦æ€§", description: "æ²–ç¸„çœŒã®çµŒæ¸ˆãƒ‡ãƒ¼ã‚¿ã‚’ç”¨ã„ã¦ã€ãƒ‡ã‚¸ã‚¿ãƒ«ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ç·Šæ€¥æ€§ã‚’è§£èª¬ã—ã¾ã™ã€‚", lastPlayed: 10, totalTime: 20 },
        { id: 2, title: "è«‹æ±‚æ›¸é›»å­åŒ–ã§å¹´é–“80æ™‚é–“å‰Šæ¸›ï¼", category: "B. æ—¥å¸¸æ¥­å‹™ã®ãƒ‡ã‚¸ã‚¿ãƒ«åŒ–", subcategory: "1. æ›¸é¡ãƒ»å¸³ç¥¨ãƒšãƒ¼ãƒ‘ãƒ¼ãƒ¬ã‚¹", tags: { difficulty: "å®Ÿè·µ", role: "ç¾å ´ãƒªãƒ¼ãƒ€ãƒ¼", time: "5-15åˆ†" }, thumbnail: "https://placehold.co/600x400/16a34a/ffffff?text=ãƒšãƒ¼ãƒ‘ãƒ¼ãƒ¬ã‚¹", description: "å…·ä½“çš„ãªãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã„ãªãŒã‚‰ã€è«‹æ±‚æ›¸ã®é›»å­åŒ–ãƒ•ãƒ­ãƒ¼ã‚’ãƒãƒ³ã‚ºã‚ªãƒ³ã§å­¦ã³ã¾ã™ã€‚", lastPlayed: 0, totalTime: 12 },
        { id: 3, title: "ChatGPTã§5åˆ†ã§ãƒ¡ãƒ¼ãƒ«ä½œæˆè¡“", category: "C. AI & ãƒ‡ãƒ¼ã‚¿æ´»ç”¨", subcategory: "1. ç”ŸæˆAIè¶…å…¥é–€", tags: { difficulty: "å…¥é–€", role: "æ–°äºº", time: "<5åˆ†" }, thumbnail: "https://placehold.co/600x400/7c3aed/ffffff?text=ChatGPT", description: "ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®åŸºæœ¬ã‹ã‚‰ã€ä¸å¯§ãªãƒ“ã‚¸ãƒã‚¹ãƒ¡ãƒ¼ãƒ«ã‚’ç¬æ™‚ã«ä½œæˆã™ã‚‹ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã¾ã§ã€‚", lastPlayed: 0, totalTime: 4 },
        { id: 4, title: "LINEå…¬å¼ã§ãƒªãƒ”ãƒ¼ã‚¿ãƒ¼ç‡ï¼‹20%è¨ˆç”»", category: "D. éƒ¨é–€åˆ¥DX", subcategory: "1. å£²ä¸Šæ‹¡å¤§ï¼ˆå–¶æ¥­ãƒ»ãƒãƒ¼ã‚±ï¼‰", tags: { difficulty: "å¿œç”¨", role: "ç®¡ç†è·", time: "15åˆ†+" }, thumbnail: "https://placehold.co/600x400/db2777/ffffff?text=LINEãƒãƒ¼ã‚±", description: "é¡§å®¢ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã«åˆã‚ã›ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é…ä¿¡ã§ã€åŠ¹æœçš„ã«ãƒªãƒ”ãƒ¼ãƒˆç‡ã‚’é«˜ã‚ã‚‹æ–¹æ³•ã€‚", lastPlayed: 15, totalTime: 30 },
        { id: 5, title: "ã‚¼ãƒ­ã‹ã‚‰å­¦ã¶ISMS/Pãƒãƒ¼ã‚¯ãƒ©ã‚¤ãƒˆ", category: "E. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ & ã‚¬ãƒãƒŠãƒ³ã‚¹", subcategory: "1. ã‚µã‚¤ãƒãƒ¼ãƒªã‚¹ã‚¯åŸºç¤", tags: { difficulty: "å…¥é–€", role: "ç®¡ç†è·", time: "15åˆ†+" }, thumbnail: "https://placehold.co/600x400/f97316/ffffff?text=ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£", description: "ä¸­å°ä¼æ¥­ãŒã¾ãšå–ã‚Šçµ„ã‚€ã¹ãæƒ…å ±ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã®ç¬¬ä¸€æ­©ã‚’è§£èª¬ã—ã¾ã™ã€‚", lastPlayed: 0, totalTime: 25 },
        { id: 6, title: "ç³¸æº€æ°´ç”£ãŒã‚¯ãƒ©ã‚¦ãƒ‰åœ¨åº«ã‚’å°å…¥ã—ãŸèˆå°è£", category: "F. ã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£", subcategory: "1. æ²–ç¸„ä¼æ¥­äº‹ä¾‹", tags: { difficulty: "å®Ÿè·µ", role: "çµŒå–¶è€…", time: "5-15åˆ†" }, thumbnail: "https://placehold.co/600x400/0891b2/ffffff?text=æ²–ç¸„äº‹ä¾‹", description: "åœ°å…ƒã®æˆåŠŸäº‹ä¾‹ã‹ã‚‰ã€å°å…¥ã®å£ã¨ãã‚Œã‚’ä¹—ã‚Šè¶ŠãˆãŸå·¥å¤«ã‚’å­¦ã³ã¾ã™ã€‚", lastPlayed: 0, totalTime: 10 },
        { id: 7, title: "ãƒ‡ã‚¸ã‚¿ãƒ«è³‡æ ¼ã‚’äººäº‹è©•ä¾¡ã«æ´»ã‹ã™æ–¹æ³•", category: "G. ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ— & ã‚­ãƒ£ãƒªã‚¢", subcategory: "1. è³‡æ ¼ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—", tags: { difficulty: "å®Ÿè·µ", role: "ç®¡ç†è·", time: "5-15åˆ†" }, thumbnail: "https://placehold.co/600x400/4d7c0f/ffffff?text=ã‚­ãƒ£ãƒªã‚¢", description: "ç¤¾å“¡ã®å­¦ç¿’ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é«˜ã‚ã‚‹ã€å…¬å¹³ãªè©•ä¾¡åˆ¶åº¦ã®ä½œã‚Šæ–¹ã€‚", lastPlayed: 0, totalTime: 13 },
        { id: 8, title: "è‡ªç¤¾ã®ç´™æ¥­å‹™ã‚’åˆ—æŒ™ã—ã¦ã¿ã‚ˆã†", category: "H. å®Ÿè·µãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—", subcategory: "1. ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ¼ãƒˆDL", tags: { difficulty: "å…¥é–€", role: "å…¨å“¡", time: "<5åˆ†" }, thumbnail: "https://placehold.co/600x400/71717a/ffffff?text=ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—", description: "ä»˜å±ã®ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ¼ãƒˆã‚’ä½¿ã£ã¦ã€ã‚ãªãŸã®ä¼šç¤¾ã®DXåŒ–ãƒã‚¤ãƒ³ãƒˆã‚’è¦‹ã¤ã‘ã¾ã—ã‚‡ã†ã€‚", lastPlayed: 0, totalTime: 5 },
        { id: 9, title: "Google Workspaceã§å¤‰ã‚ã‚‹å…±åŒä½œæ¥­", category: "B. æ—¥å¸¸æ¥­å‹™ã®ãƒ‡ã‚¸ã‚¿ãƒ«åŒ–", subcategory: "2. ã‚³ãƒ©ãƒœãƒ»ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³", tags: { difficulty: "å…¥é–€", role: "æ–°äºº", time: "5-15åˆ†" }, thumbnail: "https://placehold.co/600x400/f59e0b/ffffff?text=ã‚³ãƒ©ãƒœ", description: "å…±æœ‰ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚„ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ä½¿ã£ãŸåŠ¹ç‡çš„ãªæƒ…å ±å…±æœ‰è¡“ã€‚", lastPlayed: 0, totalTime: 10 },
        { id: 10, title: "BIãƒ„ãƒ¼ãƒ«åˆæ­©ï¼šExcelãƒ‡ãƒ¼ã‚¿ã‚’åœ°å›³ã«ãƒ—ãƒ­ãƒƒãƒˆ", category: "C. AI & ãƒ‡ãƒ¼ã‚¿æ´»ç”¨", subcategory: "2. ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–ï¼BI", tags: { difficulty: "å®Ÿè·µ", role: "ç¾å ´ãƒªãƒ¼ãƒ€ãƒ¼", time: "15åˆ†+" }, thumbnail: "https://placehold.co/600x400/84cc16/ffffff?text=ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–", description: "é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã‚’åœ°å›³ä¸Šã«å¯è¦–åŒ–ã—ã¦ã€æ–°ãŸãªå–¶æ¥­æˆ¦ç•¥ã®ãƒ’ãƒ³ãƒˆã‚’å¾—ã‚‹æ–¹æ³•ã€‚", lastPlayed: 0, totalTime: 18 },
    ];
    
    const categories = {
        "A. DXãƒªãƒ†ãƒ©ã‚·ãƒ¼åŸºç¤": "DXã®å…¨ä½“åƒã¨ãƒã‚¤ãƒ³ãƒ‰ã‚»ãƒƒãƒˆã‚’å­¦ã³ã¾ã™ã€‚",
        "B. æ—¥å¸¸æ¥­å‹™ã®ãƒ‡ã‚¸ã‚¿ãƒ«åŒ–": "ãƒšãƒ¼ãƒ‘ãƒ¼ãƒ¬ã‚¹ã‚„ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«ã§æ¥­å‹™ã‚’åŠ¹ç‡åŒ–ã—ã¾ã™ã€‚",
        "C. AI & ãƒ‡ãƒ¼ã‚¿æ´»ç”¨": "AIã‚„BIãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã„ã“ãªã—ã€ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ãŸæ„æ€æ±ºå®šã‚’æ”¯æ´ã—ã¾ã™ã€‚",
        "D. éƒ¨é–€åˆ¥DX": "å–¶æ¥­ã€çµŒç†ã€è£½é€ ãªã©ã€å„éƒ¨é–€ã«ç‰¹åŒ–ã—ãŸDXæ‰‹æ³•ã‚’å­¦ã³ã¾ã™ã€‚",
        "E. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ & ã‚¬ãƒãƒŠãƒ³ã‚¹": "DXã‚’é€²ã‚ã‚‹ä¸Šã§ä¸å¯æ¬ ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çŸ¥è­˜ã¨ä½“åˆ¶ã¥ãã‚Šã‚’å­¦ã³ã¾ã™ã€‚",
        "F. ã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£": "çœŒå†…ãƒ»å›½å†…ã®å…·ä½“çš„ãªæˆåŠŸäº‹ä¾‹ã‹ã‚‰ã€å®Ÿè·µã®ãƒ’ãƒ³ãƒˆã‚’å¾—ã¾ã™ã€‚",
        "G. ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ— & ã‚­ãƒ£ãƒªã‚¢": "DXæ™‚ä»£ã«æ±‚ã‚ã‚‰ã‚Œã‚‹ã‚¹ã‚­ãƒ«ã¨ã€ã‚­ãƒ£ãƒªã‚¢ãƒ‘ã‚¹ã‚’è€ƒãˆã¾ã™ã€‚",
        "H. å®Ÿè·µãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—": "æ‰‹ã‚’å‹•ã‹ã—ãªãŒã‚‰ã€è‡ªç¤¾ã®èª²é¡Œè§£æ±ºã«ç›´çµã™ã‚‹ã‚¹ã‚­ãƒ«ã‚’ç¿’å¾—ã—ã¾ã™ã€‚",
    };

    const userState = {
        currentPage: 'home',
        onboardingComplete: false,
        filters: { difficulty: 'ã™ã¹ã¦', role: 'ã™ã¹ã¦', time: 'ã™ã¹ã¦' },
        currentLearning: null, // Holds the ID of the course being watched
    };

    // --- TEMPLATES ---
    const getPageHTML = (pageName) => {
        switch (pageName) {
            case 'home': return `
                <div class="p-4 space-y-6 fade-in">
                    <header class="flex justify-between items-center">
                        <div>
                            <h1 class="text-2xl font-bold text-slate-800">ãƒ›ãƒ¼ãƒ </h1>
                            <p class="text-sm text-slate-500">å­¦ç¿’ã‚’å†é–‹ã—ã¾ã—ã‚‡ã†ï¼</p>
                        </div>
                        <div class="w-10 h-10 bg-slate-200 rounded-full">
                            <img src="https://placehold.co/40x40/e2e8f0/334155?text=U" class="w-10 h-10 rounded-full object-cover">
                        </div>
                    </header>
                    
                    <!-- Resume Card -->
                    ${generateResumeCard()}
                    
                    <!-- AI Recommended -->
                    ${generateCourseShelf('ã‚ãªãŸã¸ã®ãŠã™ã™ã‚', courses.slice(1, 5))}

                    <!-- New Courses -->
                    ${generateCourseShelf('æœ¬æ—¥è¿½åŠ ã•ã‚ŒãŸæ–°ç€', courses.slice(5, 9).reverse())}
                    
                    <!--æ²–ç¸„ä¼æ¥­äº‹ä¾‹ -->
                    ${generateCourseShelf('æ²–ç¸„ã®ã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£', courses.filter(c => c.category === 'F. ã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£'))}
                </div>`;
            
            case 'browse': return `
                <div class="p-4 space-y-6 fade-in">
                    <header>
                        <h1 class="text-2xl font-bold text-slate-800">ã‚³ãƒ¼ã‚¹ã‚’æ¢ã™</h1>
                        <p class="text-sm text-slate-500">èˆˆå‘³ã®ã‚ã‚‹ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰è¦‹ã¤ã‘ã‚ˆã†</p>
                    </header>
                    ${Object.keys(categories).map(cat => 
                        generateCourseShelf(cat, courses.filter(c => c.category === cat), categories[cat])
                    ).join('')}
                </div>`;
            
            case 'search': return `
                <div class="p-4 space-y-4 fade-in">
                    <header>
                        <h1 class="text-2xl font-bold text-slate-800">çµã‚Šè¾¼ã¿æ¤œç´¢</h1>
                    </header>
                    <div class="relative">
                        <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-5 h-5"></i>
                        <input id="search-input" type="text" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€ã‚¿ã‚°ã€è¬›å¸«åã§æ¤œç´¢" class="w-full pl-10 pr-4 py-3 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none transition">
                    </div>

                    <!-- Filters -->
                    <div class="space-y-3">
                        ${generateFilterGroup('é›£æ˜“åº¦', ['ã™ã¹ã¦', 'å…¥é–€', 'å®Ÿè·µ', 'å¿œç”¨'], 'difficulty')}
                        ${generateFilterGroup('å½¹å‰²', ['ã™ã¹ã¦', 'çµŒå–¶è€…', 'ç®¡ç†è·', 'ç¾å ´ãƒªãƒ¼ãƒ€ãƒ¼', 'æ–°äºº'], 'role')}
                        ${generateFilterGroup('æ‰€è¦æ™‚é–“', ['ã™ã¹ã¦', '<5åˆ†', '5-15åˆ†', '15åˆ†+'], 'time')}
                    </div>

                    <!-- Search Results -->
                    <div id="search-results" class="grid grid-cols-1 sm:grid-cols-2 gap-4 pt-4">
                        <!-- Results will be injected here -->
                    </div>
                </div>`;

            case 'learning': return `
                <div id="learning-page-content" class="fade-in">
                    <!-- Content will be injected by showLearningPage -->
                </div>
            `;
            
            case 'profile': return `
                <div class="p-4 space-y-6 fade-in">
                    <h1 class="text-2xl font-bold text-slate-800">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</h1>
                    <div class="bg-white p-6 rounded-2xl shadow-md flex flex-col items-center text-center">
                        <img src="https://placehold.co/80x80/e2e8f0/334155?text=U" class="w-20 h-20 rounded-full object-cover mb-4 ring-4 ring-blue-200">
                        <h2 class="text-xl font-bold">ç”°ä¸­ å¤ªéƒ</h2>
                        <p class="text-slate-500">æ ªå¼ä¼šç¤¾ãŠããªã‚å•†äº‹ / å–¶æ¥­éƒ¨</p>
                        <div class="mt-6 w-full space-y-4">
                            <div class="flex justify-between items-center text-left">
                                <span class="text-slate-600">å®Œäº†ã‚³ãƒ¼ã‚¹</span>
                                <span class="font-bold text-blue-600">12</span>
                            </div>
                            <div class="flex justify-between items-center text-left">
                                <span class="text-slate-600">ç²å¾—ãƒãƒƒã‚¸</span>
                                <span class="font-bold text-amber-500">5</span>
                            </div>
                             <div class="flex justify-between items-center text-left">
                                <span class="text-slate-600">ç·å­¦ç¿’æ™‚é–“</span>
                                <span class="font-bold">8æ™‚é–“ 24åˆ†</span>
                            </div>
                        </div>
                        <button class="mt-6 w-full bg-slate-100 text-slate-700 font-bold py-3 rounded-lg hover:bg-slate-200 transition">è¨­å®š</button>
                    </div>
                    <!-- Admin Dashboard Link -->
                    <div class="bg-white p-4 rounded-2xl shadow-md">
                         <button id="admin-dashboard-btn" class="w-full flex items-center justify-between text-left">
                            <div>
                                <h3 class="font-bold text-lg">ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h3>
                                <p class="text-sm text-slate-500">ãƒãƒ¼ãƒ ã®å­¦ç¿’çŠ¶æ³ã‚’ç¢ºèª</p>
                            </div>
                             <i data-lucide="shield" class="text-slate-400"></i>
                         </button>
                    </div>
                </div>`;

            case 'admin': return `
                <div class="p-4 space-y-6 fade-in">
                    <header class="flex items-center space-x-3">
                        <button id="back-to-profile-btn"><i data-lucide="arrow-left"></i></button>
                        <div>
                            <h1 class="text-2xl font-bold text-slate-800">ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
                            <p class="text-sm text-slate-500">æ ªå¼ä¼šç¤¾ãŠããªã‚å•†äº‹</p>
                        </div>
                    </header>

                    <!-- Stats Cards -->
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-white p-4 rounded-xl shadow">
                            <h3 class="text-sm text-slate-500">å—è¬›ç‡</h3>
                            <p class="text-2xl font-bold text-blue-600">85%</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow">
                            <h3 class="text-sm text-slate-500">å®Œäº†ç‡</h3>
                            <p class="text-2xl font-bold text-green-600">62%</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow col-span-2">
                            <h3 class="text-sm text-slate-500">å¹³å‡è¦–è´æ™‚é–“</h3>
                            <p class="text-2xl font-bold">12åˆ†30ç§’</p>
                        </div>
                    </div>
                    
                    <!-- Rankings -->
                    <div class="bg-white p-4 rounded-xl shadow">
                        <h3 class="font-bold mb-3">éƒ¨ç½²åˆ¥ãƒ©ãƒ³ã‚­ãƒ³ã‚° (å®Œäº†ã‚³ãƒ¼ã‚¹æ•°)</h3>
                        <div class="space-y-3">
                            <div class="flex items-center">
                                <span class="font-bold text-lg mr-3">ğŸ¥‡</span>
                                <div><p class="font-semibold">å–¶æ¥­éƒ¨</p><p class="text-sm text-slate-500">å¹³å‡ 8.5ã‚³ãƒ¼ã‚¹</p></div>
                            </div>
                             <div class="flex items-center">
                                <span class="font-bold text-lg mr-3">ğŸ¥ˆ</span>
                                <div><p class="font-semibold">é–‹ç™ºéƒ¨</p><p class="text-sm text-slate-500">å¹³å‡ 6.1ã‚³ãƒ¼ã‚¹</p></div>
                            </div>
                             <div class="flex items-center">
                                <span class="font-bold text-lg mr-3">ğŸ¥‰</span>
                                <div><p class="font-semibold">ç·å‹™éƒ¨</p><p class="text-sm text-slate-500">å¹³å‡ 4.2ã‚³ãƒ¼ã‚¹</p></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Actions -->
                    <div class="space-y-3">
                        <button class="w-full flex items-center justify-center space-x-2 bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition"><i data-lucide="download"></i><span>CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</span></button>
                        <button class="w-full flex items-center justify-center space-x-2 bg-slate-600 text-white font-bold py-3 rounded-lg hover:bg-slate-700 transition"><i data-lucide="send"></i><span>Slackã§ãƒªãƒã‚¤ãƒ³ãƒ‰</span></button>
                    </div>
                </div>`;
            default: return `<div class="p-4">ãƒšãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>`;
        }
    };

    const getOnboardingHTML = (step) => {
        switch (step) {
            case 1: return `
                <div class="p-6 text-center">
                    <i data-lucide="building-2" class="mx-auto w-12 h-12 text-blue-500 mb-4"></i>
                    <h2 class="text-xl font-bold mb-2">ã‚ãªãŸã®æ¥­ç•Œã‚’æ•™ãˆã¦ãã ã•ã„</h2>
                    <p class="text-slate-500 mb-6">æœ€é©ãªã‚³ãƒ¼ã‚¹ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚</p>
                    <div class="space-y-3">
                        ${['å»ºè¨­æ¥­', 'è£½é€ æ¥­', 'æƒ…å ±é€šä¿¡æ¥­', 'å¸å£²ãƒ»å°å£²æ¥­', 'è¦³å…‰ãƒ»å®¿æ³Šæ¥­', 'ãã®ä»–'].map(item => `<button class="onboarding-next w-full bg-slate-100 text-slate-700 font-bold py-3 rounded-lg hover:bg-slate-200 transition">${item}</button>`).join('')}
                    </div>
                </div>`;
            case 2: return `
                <div class="p-6 text-center">
                    <i data-lucide="users" class="mx-auto w-12 h-12 text-blue-500 mb-4"></i>
                    <h2 class="text-xl font-bold mb-2">ã‚ãªãŸã®å½¹å‰²ã¯ï¼Ÿ</h2>
                    <p class="text-slate-500 mb-6">å½¹å‰²ã«åˆã£ãŸã‚¹ã‚­ãƒ«ã‚’ææ¡ˆã—ã¾ã™ã€‚</p>
                    <div class="space-y-3">
                        ${['çµŒå–¶è€…', 'ç®¡ç†è·', 'ç¾å ´ãƒªãƒ¼ãƒ€ãƒ¼', 'æ–°äºº'].map(item => `<button class="onboarding-next w-full bg-slate-100 text-slate-700 font-bold py-3 rounded-lg hover:bg-slate-200 transition">${item}</button>`).join('')}
                    </div>
                </div>`;
            case 3: return `
                <div class="p-6 text-center">
                    <i data-lucide="sparkles" class="mx-auto w-12 h-12 text-blue-500 mb-4"></i>
                    <h2 class="text-xl font-bold mb-2">èˆˆå‘³ã®ã‚ã‚‹åˆ†é‡ã¯ï¼Ÿ (è¤‡æ•°é¸æŠå¯)</h2>
                    <p class="text-slate-500 mb-6">é–¢å¿ƒã‹ã‚‰å­¦ç¿’ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ã€‚</p>
                    <div class="grid grid-cols-2 gap-3">
                        ${['æ¥­å‹™åŠ¹ç‡åŒ–', 'å£²ä¸Šã‚¢ãƒƒãƒ—', 'AIæ´»ç”¨', 'ãƒãƒ¼ãƒ ç®¡ç†', 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£', 'ã‚­ãƒ£ãƒªã‚¢'].map(item => `<button class="onboarding-interest w-full bg-slate-100 text-slate-700 font-bold py-3 rounded-lg hover:bg-slate-200 transition data-[selected=true]:bg-blue-500 data-[selected=true]:text-white" data-selected="false">${item}</button>`).join('')}
                    </div>
                    <button id="onboarding-submit-interests" class="mt-6 w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition">æ¬¡ã¸</button>
                </div>`;
            case 4: return `
                <div class="p-8 text-center">
                    <i data-lucide="check-circle-2" class="mx-auto w-16 h-16 text-green-500 mb-4"></i>
                    <h2 class="text-2xl font-bold mb-2">æº–å‚™ãŒã§ãã¾ã—ãŸï¼</h2>
                    <p class="text-slate-500 mb-6">ã‚ãªãŸã«ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸå­¦ç¿’ãƒ—ãƒ©ãƒ³ãŒä½œæˆã•ã‚Œã¾ã—ãŸã€‚</p>
                    <button id="start-learning-btn" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition">å­¦ç¿’ã‚’å§‹ã‚ã‚‹</button>
                </div>`;
        }
    };

    // --- COMPONENT GENERATORS ---
    const generateCourseCard = (course, isHorizontal = false) => {
        const widthClass = isHorizontal ? 'w-60 sm:w-72' : 'w-full';
        return `
            <div class="course-card bg-white rounded-2xl shadow-md overflow-hidden flex-shrink-0 ${widthClass} snap-start cursor-pointer" data-course-id="${course.id}">
                <img src="${course.thumbnail}" alt="${course.title}" class="w-full h-32 object-cover">
                <div class="p-3">
                    <h3 class="font-bold text-sm truncate">${course.title}</h3>
                    <div class="flex items-center space-x-2 text-xs text-slate-500 mt-1">
                        <span class="bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full">${course.tags.difficulty}</span>
                        <span class="bg-green-100 text-green-700 px-2 py-0.5 rounded-full">${course.tags.role}</span>
                        <span class="bg-amber-100 text-amber-700 px-2 py-0.5 rounded-full">${course.tags.time}</span>
                    </div>
                </div>
            </div>
        `;
    };

    const generateCourseShelf = (title, courses, description = '') => {
        if (courses.length === 0) return '';
        return `
            <section>
                <h2 class="text-xl font-bold text-slate-800">${title}</h2>
                ${description ? `<p class="text-sm text-slate-500 mb-3">${description}</p>` : '<div class="mb-3"></div>'}
                <div class="flex space-x-4 overflow-x-auto pb-4 hide-scrollbar snap-x-mandatory">
                    ${courses.map(course => generateCourseCard(course, true)).join('')}
                </div>
            </section>
        `;
    };
    
    const generateResumeCard = () => {
        const resumeCourse = courses.find(c => c.lastPlayed > 0);
        if (!resumeCourse) return `
            <div class="bg-white p-4 rounded-2xl shadow-md text-center">
                <h3 class="font-bold">æ–°ã—ã„ã‚³ãƒ¼ã‚¹ã‚’å§‹ã‚ã‚ˆã†ï¼</h3>
                <p class="text-sm text-slate-500">ã€Œæ¢ã™ã€ã‚¿ãƒ–ã‹ã‚‰èˆˆå‘³ã®ã‚ã‚‹ã‚³ãƒ¼ã‚¹ã‚’è¦‹ã¤ã‘ã¾ã—ã‚‡ã†ã€‚</p>
            </div>
        `;

        const progress = (resumeCourse.lastPlayed / resumeCourse.totalTime) * 100;
        return `
            <div class="course-card bg-white p-4 rounded-2xl shadow-lg cursor-pointer" data-course-id="${resumeCourse.id}">
                <p class="text-sm font-bold text-blue-600 mb-2">ç¶šãã‹ã‚‰å†ç”Ÿ</p>
                <div class="flex items-center space-x-4">
                    <img src="${resumeCourse.thumbnail}" alt="${resumeCourse.title}" class="w-16 h-16 object-cover rounded-lg">
                    <div class="flex-1">
                        <h3 class="font-bold text-md">${resumeCourse.title}</h3>
                        <p class="text-xs text-slate-500">${resumeCourse.subcategory}</p>
                        <div class="w-full bg-slate-200 rounded-full h-2 mt-2">
                            <div class="bg-blue-500 h-2 rounded-full" style="width: ${progress}%"></div>
                        </div>
                    </div>
                    <i data-lucide="play-circle" class="w-8 h-8 text-blue-500"></i>
                </div>
            </div>
        `;
    };

    const generateFilterGroup = (label, options, filterKey) => `
        <div>
            <h3 class="text-sm font-semibold text-slate-600 mb-2">${label}</h3>
            <div class="flex flex-wrap gap-2">
                ${options.map(option => `
                    <button class="filter-btn px-4 py-1.5 rounded-full text-sm font-semibold transition
                        ${userState.filters[filterKey] === option 
                            ? 'bg-blue-600 text-white' 
                            : 'bg-white text-slate-700 hover:bg-slate-100'}"
                        data-filter-key="${filterKey}" data-filter-value="${option}">
                        ${option}
                    </button>
                `).join('')}
            </div>
        </div>
    `;

    // --- PAGE RENDERING LOGIC ---
    const appContainer = document.getElementById('app-container');

    const renderPage = (pageName) => {
        userState.currentPage = pageName;
        appContainer.innerHTML = getPageHTML(pageName);
        lucide.createIcons();
        updateActiveTab();
        addPageEventListeners(pageName);
        window.scrollTo(0, 0);

        if (pageName === 'search') {
            renderSearchResults();
        }
    };
    
    const showLearningPage = (courseId) => {
        const course = courses.find(c => c.id == courseId);
        if (!course) return;

        userState.currentLearning = courseId;
        appContainer.innerHTML = `
            <div class="fade-in">
                 <!-- 1. Video Player Area -->
                <div class="relative bg-black aspect-video">
                    <video class="w-full h-full" poster="${course.thumbnail}" controls>
                        <!-- In a real app, HLS source would go here -->
                    </video>
                    <div class="absolute top-4 left-4">
                        <button id="back-to-previous" class="w-10 h-10 bg-black/50 rounded-full flex items-center justify-center text-white">
                            <i data-lucide="arrow-left"></i>
                        </button>
                    </div>
                     <div class="absolute top-4 right-4">
                        <button class="w-10 h-10 bg-black/50 rounded-full flex items-center justify-center text-white">
                            <i data-lucide="picture-in-picture-2"></i>
                        </button>
                    </div>
                </div>

                <!-- 2. Info and Controls -->
                <div class="p-4 bg-white">
                    <h1 class="text-xl font-bold">${course.title}</h1>
                    <p class="text-sm text-slate-500">${course.subcategory}</p>
                    <div class="flex justify-between items-center mt-4">
                        <div class="flex space-x-2">
                            <span class="bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full text-xs">${course.tags.difficulty}</span>
                            <span class="bg-green-100 text-green-700 px-2 py-0.5 rounded-full text-xs">${course.tags.time}</span>
                        </div>
                         <select id="playback-speed" class="bg-slate-100 border-none rounded-md text-sm px-2 py-1">
                            <option value="1">1.0x</option>
                            <option value="1.25">1.25x</option>
                            <option value="1.5">1.5x</option>
                            <option value="2">2.0x</option>
                        </select>
                    </div>
                </div>

                <!-- 3. Interactive Transcript -->
                <div class="p-4">
                    <h2 class="font-bold mb-2">ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–å­—å¹•</h2>
                    <div class="bg-white p-4 rounded-lg h-64 overflow-y-auto space-y-3">
                        ${generateTranscript(course)}
                    </div>
                </div>

                 <!-- 4. "ã‚„ã£ã¦ã¿ã‚‹"ã‚·ãƒ¼ãƒˆ -->
                <div class="p-4">
                    <div class="bg-yellow-100 border-l-4 border-yellow-400 p-4 rounded-r-lg">
                        <h3 class="font-bold text-yellow-800">ã‚„ã£ã¦ã¿ã‚‹ã‚·ãƒ¼ãƒˆ</h3>
                        <p class="text-sm text-yellow-700 mt-1">ã€Œè‡ªç¤¾ã®ç´™æ¥­å‹™ã‚’5ã¤æ›¸ãå‡ºã—ã¦ã¿ã‚ˆã†ã€</p>
                        <button id="task-complete-btn" class="mt-3 bg-yellow-400 text-yellow-900 font-bold px-4 py-2 rounded-lg text-sm hover:bg-yellow-500 transition">å®Œäº†ãƒã‚§ãƒƒã‚¯</button>
                    </div>
                </div>
            </div>`;

        lucide.createIcons();

        document.getElementById('back-to-previous').addEventListener('click', () => {
            renderPage('home'); // or whichever page they came from
        });

        document.getElementById('task-complete-btn').addEventListener('click', showCompletionPopup);
    };

    const generateTranscript = (course) => {
        // Dummy transcript data
        const dummyTranscript = [
            { time: "0:05", text: "çš†ã•ã‚“ã€ã“ã‚“ã«ã¡ã¯ã€‚æœ¬æ—¥ã¯ã€Œ" + course.title + "ã€ã«ã¤ã„ã¦ãŠè©±ã—ã—ã¾ã™ã€‚" },
            { time: "0:15", text: "ã¾ãšã€åŸºæœ¬ã¨ãªã‚‹è€ƒãˆæ–¹ã‹ã‚‰èª¬æ˜ã—ã¾ã™ã€‚DXã¨ã¯å˜ãªã‚‹ãƒ‡ã‚¸ã‚¿ãƒ«åŒ–ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚" },
            { time: "0:28", text: "é‡è¦ãªã®ã¯ã€ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«ãã®ã‚‚ã®ã‚’å¤‰é©ã™ã‚‹ã“ã¨ã§ã™ã€‚" },
            { time: "0:40", text: "ã“ã®ã‚°ãƒ©ãƒ•ã‚’ã”è¦§ãã ã•ã„ã€‚ã“ã‚Œã¯..." },
            { time: "0:55", text: "ã¤ã¾ã‚Šã€ã“ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€æ–°ãŸãªé¡§å®¢ä¾¡å€¤ã‚’å‰µé€ ã§ãã‚‹ã®ã§ã™ã€‚" },
            { time: "1:10", text: "å…·ä½“çš„ãªäº‹ä¾‹ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚æ²–ç¸„ã®Aç¤¾ã§ã¯..." },
            { time: "1:25", text: "ã“ã®çµæœã€å¹´é–“ã§ãŠã‚ˆã80æ™‚é–“ã®æ¥­å‹™å‰Šæ¸›ã«æˆåŠŸã—ã¾ã—ãŸã€‚" },
        ];
        return dummyTranscript.map(line => `
            <div class="flex cursor-pointer hover:bg-slate-100 p-1 rounded">
                <span class="w-16 font-mono text-sm text-blue-600">${line.time}</span>
                <p class="flex-1 text-sm text-slate-700">${line.text}</p>
            </div>
        `).join('');
    };
    
    const showCompletionPopup = () => {
        const popup = document.createElement('div');
        popup.className = 'fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4';
        popup.innerHTML = `
            <div class="bg-white rounded-2xl p-6 text-center shadow-xl transform scale-95 transition-transform duration-300 w-full max-w-sm">
                <i data-lucide="badge-check" class="w-16 h-16 text-green-500 mx-auto mb-3"></i>
                <h2 class="text-xl font-bold">ãƒŠã‚¤ã‚¹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼</h2>
                <p class="text-slate-500 my-2">æ–°ã—ã„ãƒãƒƒã‚¸ã‚’ç²å¾—ã—ã¾ã—ãŸï¼</p>
                
                <div class="bg-slate-100 p-4 rounded-lg mt-4 text-left">
                    <p class="text-sm font-bold text-slate-800">æ¬¡ã«ã‚„ã‚‹ã¹ã1åˆ†ã‚¿ã‚¹ã‚¯</p>
                    <p class="text-sm text-slate-600">æ›¸ãå‡ºã—ãŸç´™æ¥­å‹™ã®ä¸­ã§ã€æ˜æ—¥ã‹ã‚‰é›»å­åŒ–ã§ããã†ãªã‚‚ã®ã‚’1ã¤é¸ã‚“ã§ãƒãƒ¼ãƒ ã«å…±æœ‰ã—ã‚ˆã†ã€‚</p>
                </div>

                <div class="flex gap-3 mt-6">
                    <button id="share-btn" class="flex-1 bg-blue-500 text-white font-bold py-3 rounded-lg flex items-center justify-center gap-2"><i data-lucide="share-2"></i><span>å…±æœ‰</span></button>
                    <button id="close-popup-btn" class="flex-1 bg-slate-200 text-slate-800 font-bold py-3 rounded-lg">é–‰ã˜ã‚‹</button>
                </div>
            </div>
        `;
        document.body.appendChild(popup);
        lucide.createIcons();

        // Animate entrance
        setTimeout(() => popup.querySelector('div').classList.remove('scale-95'), 10);
        
        popup.querySelector('#close-popup-btn').addEventListener('click', () => {
            popup.remove();
            renderPage('home');
        });
         popup.querySelector('#share-btn').addEventListener('click', () => {
            alert('å…±æœ‰ãƒªãƒ³ã‚¯ãŒã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã¾ã—ãŸ (ãƒ¢ãƒƒã‚¯)');
        });
    };

    // --- SEARCH & FILTER LOGIC ---
    const renderSearchResults = () => {
        const resultsContainer = document.getElementById('search-results');
        if (!resultsContainer) return;
        
        const searchTerm = document.getElementById('search-input')?.value.toLowerCase() || '';
        
        const filtered = courses.filter(course => {
            const matchesSearch = searchTerm === '' || 
                                  course.title.toLowerCase().includes(searchTerm) ||
                                  course.description.toLowerCase().includes(searchTerm) ||
                                  Object.values(course.tags).some(tag => tag.toLowerCase().includes(searchTerm));

            const matchesDifficulty = userState.filters.difficulty === 'ã™ã¹ã¦' || course.tags.difficulty === userState.filters.difficulty;
            const matchesRole = userState.filters.role === 'ã™ã¹ã¦' || course.tags.role === userState.filters.role || course.tags.role === 'å…¨å“¡';
            const matchesTime = userState.filters.time === 'ã™ã¹ã¦' || course.tags.time === userState.filters.time;
            
            return matchesSearch && matchesDifficulty && matchesRole && matchesTime;
        });

        if (filtered.length > 0) {
            resultsContainer.innerHTML = filtered.map(course => generateCourseCard(course, false)).join('');
        } else {
            resultsContainer.innerHTML = `<div class="text-center text-slate-500 col-span-full py-8">
                <i data-lucide="frown" class="w-12 h-12 mx-auto text-slate-400 mb-2"></i>
                <p>æ¡ä»¶ã«åˆã†ã‚³ãƒ¼ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
            </div>`;
            lucide.createIcons();
        }
        addCourseCardListeners();
    };

    // --- EVENT LISTENERS ---
    const addPageEventListeners = (pageName) => {
        addCourseCardListeners();

        if (pageName === 'search') {
            document.getElementById('search-input').addEventListener('keyup', renderSearchResults);
            document.querySelectorAll('.filter-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const key = e.currentTarget.dataset.filterKey;
                    const value = e.currentTarget.dataset.filterValue;
                    userState.filters[key] = value;
                    
                    // Update button styles
                    document.querySelectorAll(`.filter-btn[data-filter-key="${key}"]`).forEach(btn => {
                        btn.classList.remove('bg-blue-600', 'text-white');
                        btn.classList.add('bg-white', 'text-slate-700', 'hover:bg-slate-100');
                    });
                    e.currentTarget.classList.add('bg-blue-600', 'text-white');
                    e.currentTarget.classList.remove('bg-white', 'text-slate-700', 'hover:bg-slate-100');
                    
                    renderSearchResults();
                });
            });
        }
        
        if (pageName === 'profile') {
            document.getElementById('admin-dashboard-btn').addEventListener('click', () => renderPage('admin'));
        }

        if (pageName === 'admin') {
            document.getElementById('back-to-profile-btn').addEventListener('click', () => renderPage('profile'));
        }
    };

    const addCourseCardListeners = () => {
        document.querySelectorAll('.course-card').forEach(card => {
            card.addEventListener('click', (e) => {
                const courseId = e.currentTarget.dataset.courseId;
                showLearningPage(courseId);
            });
        });
    };

    const updateActiveTab = () => {
        document.querySelectorAll('.nav-button').forEach(button => {
            button.classList.remove('active-tab');
            if (button.dataset.page === userState.currentPage) {
                button.classList.add('active-tab');
            }
        });
    };

    // --- ONBOARDING LOGIC ---
    const onboardingModal = document.getElementById('onboarding-modal');
    const onboardingContent = document.getElementById('onboarding-content');
    let currentStep = 1;

    const showOnboardingStep = (step) => {
        currentStep = step;
        onboardingContent.innerHTML = getOnboardingHTML(step);
        lucide.createIcons();
        
        if (step < 3) {
            onboardingContent.querySelectorAll('.onboarding-next').forEach(btn => {
                btn.addEventListener('click', () => showOnboardingStep(step + 1));
            });
        } else if (step === 3) {
            onboardingContent.querySelectorAll('.onboarding-interest').forEach(btn => {
                btn.addEventListener('click', () => {
                    const isSelected = btn.dataset.selected === 'true';
                    btn.dataset.selected = !isSelected;
                });
            });
             onboardingContent.querySelector('#onboarding-submit-interests').addEventListener('click', () => showOnboardingStep(4));
        } else if (step === 4) {
             onboardingContent.querySelector('#start-learning-btn').addEventListener('click', () => {
                onboardingModal.style.display = 'none';
                userState.onboardingComplete = true;
                renderPage('home');
             });
        }
    };

    // --- INITIALIZATION ---
    // Bottom Nav
    document.querySelectorAll('.nav-button').forEach(button => {
        button.addEventListener('click', (e) => {
            const page = e.currentTarget.dataset.page;
            if (page === 'learning') {
                if (userState.currentLearning) {
                    showLearningPage(userState.currentLearning);
                } else {
                    appContainer.innerHTML = `
                    <div class="p-4 text-center text-slate-500 fade-in h-screen flex flex-col justify-center items-center">
                        <i data-lucide="play-circle" class="w-16 h-16 text-slate-300 mb-4"></i>
                        <h2 class="text-xl font-bold">å­¦ç¿’ä¸­ã®ã‚³ãƒ¼ã‚¹ã¯ã‚ã‚Šã¾ã›ã‚“</h2>
                        <p class="mt-2">ã‚³ãƒ¼ã‚¹ã‚’é¸æŠã™ã‚‹ã¨ã€ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
                    </div>`;
                    lucide.createIcons();
                    userState.currentPage = 'learning';
                    updateActiveTab();
                }
            } else {
                renderPage(page);
            }
        });
    });

    // Initial Render
    if (!userState.onboardingComplete) {
        showOnboardingStep(1);
    } else {
        onboardingModal.style.display = 'none';
        renderPage('home');
    }
});
</script>

</body>
</html>
