<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UGCè¨­è¨ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚²ãƒ¼ãƒ  Ver.6</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
        }
        .step-card, .modal-content, .game-over-screen {
            transition: all 0.5s ease-in-out;
        }
        .hidden-step {
            opacity: 0;
            transform: translateY(20px);
            position: absolute;
            width: 100%;
            pointer-events: none;
        }
        .progress-bar-fill {
            transition: width 0.5s ease-in-out;
        }
        input[type="radio"]:checked + label,
        input[type="checkbox"]:checked + label {
            transform: scale(1.05);
            box-shadow: 0 0 0 3px #3b82f6;
        }
        input[type="radio"].quiz-option:checked + label {
             background-color: #dbeafe;
             border-color: #3b82f6;
        }
        .trust-bar-fill {
            transition: width 0.5s ease-in-out, background-color 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl mx-auto bg-white rounded-2xl shadow-2xl p-6 md:p-10 space-y-6">
        
        <header class="text-center">
            <h1 class="text-2xl md:text-3xl font-extrabold text-gray-800">UGCè¨­è¨ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚²ãƒ¼ãƒ  Ver.6</h1>
            <p class="text-sm md:text-base text-gray-500 mt-2">æœ€å¼·ã®ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ãƒ—ãƒ©ãƒ³ã‚’è¨­è¨ˆã—ã€ç„¡äº‹ã«ãƒ­ãƒ¼ãƒ³ãƒã›ã‚ˆï¼</p>
        </header>

        <div id="previous-result-container" class="mb-6"></div>

        <div class="space-y-3">
            <div id="mission-goals-display" class="grid grid-cols-2 md:grid-cols-4 gap-2 text-center text-sm"></div>
            <div class="space-y-2">
                <div>
                    <span class="text-sm font-bold">é€²è¡Œåº¦</span>
                    <div class="w-full bg-gray-200 rounded-full h-4">
                        <div id="progress-bar" class="bg-blue-500 h-4 rounded-full progress-bar-fill" style="width: 0%;"></div>
                    </div>
                </div>
                 <div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm font-bold">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¿¡é ¼åº¦</span>
                        <span id="trust-value" class="text-sm font-bold text-gray-600">100%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-4">
                        <div id="trust-bar" class="h-4 rounded-full trust-bar-fill bg-green-500" style="width: 100%;"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="text-center text-sm font-bold text-gray-600">
            <span id="step-counter">ã‚¹ãƒ†ãƒƒãƒ— 0 / 11</span>
        </div>

        <main id="game-container" class="relative min-h-[450px]">
             <!-- ã‚¹ãƒ†ãƒƒãƒ—0: ãƒ—ãƒ­ãƒ­ãƒ¼ã‚° & å•†å“é¸æŠ -->
            <div id="step-0" class="step-card space-y-4">
                <h2 class="text-xl font-bold text-center">ãƒ—ãƒ­ãƒ­ãƒ¼ã‚°</h2>
                <div class="bg-gray-100 p-4 rounded-lg text-center">
                    <p class="mb-2">ã‚ãªãŸã¯ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒã‚§ãƒ¼ãƒ³ã€Œãƒã‚¹ãƒãƒ¼ã‚¬ãƒ¼ã€ã®ãƒãƒ¼ã‚±ã‚¿ãƒ¼ã€‚</p>
                    <p class="mb-4">ç¤¾é•·ã‹ã‚‰ç›´ã€…ã«ã€Œæ–°å•†å“ã®UGCã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’æˆåŠŸã•ã›ã‚ï¼ã€ã¨ã®ç‰¹å‘½ãŒä¸‹ã£ãŸã€‚</p>
                    <p class="font-bold">ã¾ãšã¯ã€ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³å¯¾è±¡ã®å•†å“ã‚’é¸ã¼ã†ï¼</p>
                </div>
                <div id="product-options" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div>
                <button onclick="nextStep(1)" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg">ã“ã®å•†å“ã§ä¼ç”»ã‚’å§‹ã‚ã‚‹</button>
            </div>

            <!-- ã‚¹ãƒ†ãƒƒãƒ—1: Mission Briefing -->
            <div id="step-1" class="step-card space-y-4 hidden-step">
                <h2 class="text-xl font-bold text-center">ä»Šå›ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³</h2>
                <p class="text-center">ä»¥ä¸‹ã®KPIç›®æ¨™ã‚’ã™ã¹ã¦é”æˆã™ã‚‹ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’ä¼ç”»ã›ã‚ˆï¼</p>
                <div id="mission-briefing-display" class="grid grid-cols-2 gap-4 text-center"></div>
                <div class="flex space-x-4">
                    <button onclick="prevStep(0)" class="w-1/2 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-4 rounded-lg">æˆ»ã‚‹</button>
                    <button onclick="nextStep(2)" class="w-1/2 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg">ãƒŸãƒƒã‚·ãƒ§ãƒ³é–‹å§‹</button>
                </div>
            </div>

            <!-- ã‚¹ãƒ†ãƒƒãƒ—2: KGIè¨­å®š -->
            <div id="step-2" class="step-card space-y-4 hidden-step">
                <h2 class="text-xl font-bold">â‘¡ ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã®æœ€é‡è¦ç›®çš„(KGI)ã¯ï¼Ÿ</h2>
                <div id="kgi-options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                <div class="flex space-x-4">
                    <button onclick="prevStep(1)" class="w-1/2 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-4 rounded-lg">æˆ»ã‚‹</button>
                    <button onclick="nextStep(3)" class="w-1/2 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg">æ¬¡ã¸</button>
                </div>
            </div>
            
            <!-- ã‚¹ãƒ†ãƒƒãƒ—3: ã‚¿ãƒ¼ã‚²ãƒƒãƒˆé¸æŠ -->
            <div id="step-3" class="step-card space-y-4 hidden-step">
                <h2 class="text-xl font-bold">â‘¢ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¯èª°ï¼Ÿ</h2>
                <div id="target-options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                <div class="flex space-x-4">
                    <button onclick="prevStep(2)" class="w-1/2 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-4 rounded-lg">æˆ»ã‚‹</button>
                    <button onclick="nextStep(4)" class="w-1/2 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg">æ¬¡ã¸</button>
                </div>
            </div>

             <!-- ã‚¹ãƒ†ãƒƒãƒ—4: ãƒšãƒ«ã‚½ãƒŠåˆ†æ -->
            <div id="step-4" class="step-card space-y-4 hidden-step">
                <h2 class="text-xl font-bold">â‘£ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’æ·±æ˜ã‚Šåˆ†æï¼</h2>
                <div id="persona-display" class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500 space-y-3"></div>
                <p class="text-sm text-center text-gray-600">ã“ã®æƒ…å ±ã¯å¾Œã®ã‚¯ã‚¤ã‚ºã§é‡è¦ã«ãªã‚Šã¾ã™ã€‚ãƒãƒ¼ãƒ ã§å…±æœ‰ã—ã¾ã—ã‚‡ã†ã€‚</p>
                <div class="flex space-x-4">
                    <button onclick="prevStep(3)" class="w-1/2 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-4 rounded-lg">æˆ»ã‚‹</button>
                    <button onclick="nextStep(5)" class="w-1/2 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg">æ¬¡ã¸</button>
                </div>
            </div>

            <!-- ã‚¹ãƒ†ãƒƒãƒ—5: è¨´æ±‚é¸æŠ -->
            <div id="step-5" class="step-card space-y-4 hidden-step">
                <h2 class="text-xl font-bold">â‘¤ ã©ã‚“ãªé­…åŠ›ã§ã‚¢ãƒ”ãƒ¼ãƒ«ã™ã‚‹ï¼Ÿ (2ã¤ã¾ã§)</h2>
                <div id="appeal-options" class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>
                <p id="appeal-error" class="text-red-500 text-sm hidden">2ã¤ã¾ã§ã—ã‹é¸æŠã§ãã¾ã›ã‚“ã€‚</p>
                <div class="flex space-x-4">
                    <button onclick="prevStep(4)" class="w-1/2 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-4 rounded-lg">æˆ»ã‚‹</button>
                    <button onclick="nextStep(6)" class="w-1/2 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg">æ¬¡ã¸</button>
                </div>
            </div>

            <!-- ã‚¹ãƒ†ãƒƒãƒ—6: ä¸­é–“ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
            <div id="step-6" class="step-card space-y-6 hidden-step">
                <h2 class="text-xl font-bold text-center text-red-500">ğŸš¨ æœ€é‡è¦é–¢é–€ï¼šä¸­é–“ãƒ¬ãƒ“ãƒ¥ãƒ¼ ğŸš¨</h2>
                <div id="review-container" class="space-y-4"></div>
                <p id="review-error" class="text-red-600 font-bold text-center hidden"></p>
                <div class="flex space-x-4">
                    <button onclick="prevStep(5)" class="w-1/2 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-4 rounded-lg">æˆ»ã‚‹</button>
                    <button onclick="checkReview()" class="w-1/2 bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-lg">å›ç­”ã‚’æå‡º</button>
                </div>
            </div>
            
            <!-- ã‚¹ãƒ†ãƒƒãƒ—7: åª’ä½“é¸æŠ + äºˆç®—é…åˆ† -->
            <div id="step-7" class="step-card space-y-6 hidden-step">
                <h2 class="text-xl font-bold">â‘¦ ã©ã®åª’ä½“ã§ç™ºä¿¡ã™ã‚‹ï¼Ÿ (2ã¤ã¾ã§)</h2>
                <div id="media-options" class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>
                 <p id="media-error" class="text-red-500 text-sm hidden">2ã¤ã¾ã§ã—ã‹é¸æŠã§ãã¾ã›ã‚“ã€‚</p>
                <div id="budget-allocator" class="space-y-4 hidden">
                    <h3 class="text-lg font-bold">åºƒå‘Šäºˆç®—é…åˆ† (åˆè¨ˆ: <span id="remaining-budget-display">1,000,000</span>å††)</h3>
                    <div id="budget-sliders" class="space-y-4"></div>
                    <div class="text-right font-bold text-lg"><span>åˆè¨ˆäºˆç®—: </span><span id="total-budget">0</span>å††</div>
                     <p id="budget-error" class="text-red-500 text-sm text-right hidden"></p>
                </div>
                <div class="flex space-x-4">
                    <button onclick="prevStep(6)" class="w-1/2 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-4 rounded-lg">æˆ»ã‚‹</button>
                    <button onclick="nextStep(8)" class="w-1/2 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg">æ¬¡ã¸</button>
                </div>
            </div>

            <!-- ã‚¹ãƒ†ãƒƒãƒ—8: ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–é¸æŠ -->
            <div id="step-8" class="step-card space-y-4 hidden-step">
                <h2 class="text-xl font-bold">â‘§ ã©ã‚“ãªã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã«ã™ã‚‹ï¼Ÿ</h2>
                <div id="creative-options" class="grid grid-cols-1 gap-4"></div>
                <div class="flex space-x-4">
                    <button onclick="prevStep(7)" class="w-1/2 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-4 rounded-lg">æˆ»ã‚‹</button>
                    <button onclick="nextStep(9)" class="w-1/2 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg">æ¬¡ã¸</button>
                </div>
            </div>
            
            <!-- ã‚¹ãƒ†ãƒƒãƒ—9: ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼é¸å®š -->
            <div id="step-9" class="step-card space-y-4 hidden-step">
                <h2 class="text-xl font-bold">â‘¨ å”åŠ›ã™ã‚‹ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ã¯ï¼Ÿ (1å)</h2>
                <div id="influencer-options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                <div class="flex space-x-4">
                    <button onclick="prevStep(8)" class="w-1/2 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-4 rounded-lg">æˆ»ã‚‹</button>
                    <button onclick="nextStep(10)" class="w-1/2 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg">æ¬¡ã¸</button>
                </div>
            </div>

            <!-- ã‚¹ãƒ†ãƒƒãƒ—10: ã‚¤ãƒ³ã‚»ãƒ³ãƒ†ã‚£ãƒ–è¨­è¨ˆ -->
            <div id="step-10" class="step-card space-y-4 hidden-step">
                <h2 class="text-xl font-bold">â‘© UGCã‚’ä¿ƒã™ã‚¤ãƒ³ã‚»ãƒ³ãƒ†ã‚£ãƒ–ã¯ï¼Ÿ</h2>
                <div id="incentive-options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                <div class="flex space-x-4">
                    <button onclick="prevStep(9)" class="w-1/2 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-4 rounded-lg">æˆ»ã‚‹</button>
                    <button onclick="nextStep(11)" class="w-1/2 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg">æ¬¡ã¸</button>
                </div>
            </div>

            <!-- ã‚¹ãƒ†ãƒƒãƒ—11: UGCä¼ç”»è©³ç´° -->
            <div id="step-11" class="step-card space-y-4 hidden-step">
                <h2 class="text-xl font-bold">â‘ª ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å·»ãè¾¼ã‚€UGCä¼ç”»ã‚’ç·´ã‚ã†ï¼</h2>
                <div class="space-y-4">
                    <div>
                        <label for="ugc-hashtag" class="font-bold">ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°æ¡ˆ</label>
                        <input type="text" id="ugc-hashtag" class="w-full p-2 border-2 border-gray-300 rounded-lg" placeholder="ä¾‹ï¼š#ã€‡ã€‡ãƒãƒ£ãƒ¬ãƒ³ã‚¸">
                    </div>
                    <div>
                        <label for="ugc-catchphrase" class="font-bold">ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼</label>
                        <input type="text" id="ugc-catchphrase" class="w-full p-2 border-2 border-gray-300 rounded-lg" placeholder="ä¾‹ï¼šã¿ã‚“ãªã§æŠ•ç¨¿ã—ã¦æ™¯å“ã‚’ã‚²ãƒƒãƒˆï¼">
                    </div>
                </div>
                <div class="flex space-x-4">
                    <button onclick="prevStep(10)" class="w-1/2 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-4 rounded-lg">æˆ»ã‚‹</button>
                    <button onclick="showResults()" class="w-1/2 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg">æœ€çµ‚çµæœã‚’è¦‹ã‚‹ï¼</button>
                </div>
            </div>
            
            <!-- ã‚¹ãƒ†ãƒƒãƒ—12: çµæœè¡¨ç¤º -->
            <div id="step-12" class="step-card space-y-6 hidden-step">
                <h2 id="result-title" class="text-3xl font-extrabold text-center"></h2>
                <div id="badge-container" class="flex flex-wrap justify-center gap-4"></div>
                <div class="bg-blue-50 p-4 rounded-lg">
                     <h3 class="font-bold text-lg mb-2">ã‚ãªãŸã®ãƒ—ãƒ©ãƒ³</h3>
                     <p><strong>å•†å“:</strong> <span id="result-product"></span></p>
                     <p><strong>KGI:</strong> <span id="result-kgi"></span></p>
                     <p><strong>ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ:</strong> <span id="result-target"></span></p>
                     <p><strong>è¨´æ±‚è»¸:</strong> <span id="result-appeals"></span></p>
                </div>
                <div id="sns-preview-container" class="bg-white p-4 rounded-lg shadow-md max-w-md mx-auto"></div>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white border border-gray-300">
                        <thead class="bg-gray-200">
                            <tr><th>æŒ‡æ¨™</th><th>ç›®æ¨™</th><th>çµæœ</th><th>é”æˆåº¦</th></tr>
                        </thead>
                        <tbody id="result-kpi-table"></tbody>
                    </table>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white border border-gray-300">
                        <thead class="bg-gray-200">
                            <tr><th>åª’ä½“</th><th>äºˆç®—</th><th>Imp</th><th>ã‚¯ãƒªãƒƒã‚¯æ•°</th><th>CTR</th><th>CPC</th></tr>
                        </thead>
                        <tbody id="result-table-body"></tbody>
                        <tfoot class="font-bold bg-gray-100">
                           <tr><td>åˆè¨ˆ</td><td id="total-result-budget"></td><td id="total-result-imp"></td><td id="total-result-clicks"></td><td>-</td><td id="total-result-cpc"></td></tr>
                        </tfoot>
                    </table>
                </div>
                <div class="grid md:grid-cols-3 gap-4 text-center">
                    <div class="bg-green-100 p-4 rounded-lg">
                        <h4 class="font-bold">ãƒ–ãƒ©ãƒ³ãƒ‰å¥½æ„Ÿåº¦</h4><p id="result-brand" class="text-2xl font-bold"></p>
                    </div>
                    <div class="bg-yellow-100 p-4 rounded-lg">
                        <h4 class="font-bold">è©±é¡Œæ€§</h4><p id="result-buzz" class="text-2xl font-bold"></p>
                    </div>
                     <div class="bg-red-100 p-4 rounded-lg">
                        <h4 class="font-bold">ç‚ä¸Šãƒªã‚¹ã‚¯</h4><p id="result-risk" class="text-2xl font-bold"></p>
                    </div>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="font-bold text-lg mb-2">ç™ºç”Ÿã—ãŸã‚¤ãƒ™ãƒ³ãƒˆãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœ</h3>
                     <ul id="event-log-list" class="list-disc list-inside text-sm text-gray-700"><li>ã‚¤ãƒ™ãƒ³ãƒˆã¯ç™ºç”Ÿã—ã¾ã›ã‚“ã§ã—ãŸã€‚</li></ul>
                </div>
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h3 class="font-bold text-lg mb-2">ğŸ’¡ ç·è©•ã¨è§£èª¬</h3>
                    <div id="result-commentary" class="text-sm space-y-2"></div>
                </div>
                <button onclick="restartGame()" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-lg">ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ã™ã‚‹</button>
            </div>
        </main>
    </div>

    <!-- ã‚¤ãƒ™ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="event-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden modal-backdrop opacity-0">
        <div class="bg-white rounded-2xl shadow-xl p-8 max-w-md w-full text-center space-y-4 modal-content transform scale-95">
            <h2 id="event-title" class="text-2xl font-extrabold"></h2>
            <div id="event-icon" class="text-6xl"></div>
            <p id="event-description" class="text-gray-600"></p>
            <button onclick="closeEventModal()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg">ç¢ºèª</button>
        </div>
    </div>
    
    <!-- ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="game-over-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 hidden game-over-screen opacity-0">
        <div id="game-over-content" class="bg-white rounded-2xl shadow-xl p-8 max-w-md w-full text-center space-y-4 transform scale-95">
            <h2 class="text-4xl font-extrabold text-red-600">GAME OVER</h2>
            <div class="text-8xl">ğŸ’€</div>
            <p id="game-over-reason" class="text-gray-700 font-bold"></p>
            <p class="text-sm text-gray-500">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ä¸­æ­¢ã«ãªã‚Šã¾ã—ãŸã€‚</p>
            <button onclick="restartGame()" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-lg">ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ã™ã‚‹</button>
        </div>
    </div>


<script>
// --- ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿å®šç¾© ---
const gameData = {
    missionGoals: { imp: 800000, clicks: 7000, ctr: 1.2, cpc: 150 },
    products: [
        { id: 'P1', name: 'ãƒ˜ãƒ«ã‚·ãƒ¼ãƒ™ã‚¸ãƒãƒ¼ã‚¬ãƒ¼', icon: 'ğŸ¥—', desc: 'å¥åº·å¿—å‘ã®å¥³æ€§ã‚„ã‚·ãƒ‹ã‚¢å±¤ã«ã€‚', effects: { compatibility_mod: { 'T3': {'A4': 1.5, 'A2': 1.2}, 'T5': {'A4': 2.0} } } },
        { id: 'P2', name: 'ãƒ“ãƒ¼ãƒ•çˆ†å¼¾ãƒãƒ¼ã‚¬ãƒ¼', icon: 'ğŸ’£', desc: 'é£Ÿã¹ç››ã‚Šã®è‹¥è€…ã‚„ç”·æ€§ã«ã€‚', effects: { compatibility_mod: { 'T1': {'A1': 1.5, 'A6': 1.2}, 'T2': {'A2': 1.5} } } },
        { id: 'P3', name: 'ã‚³ã‚¹ãƒ‘æœ€å¼·ãƒãƒ¼ã‚¬ãƒ¼', icon: 'ğŸ’°', desc: 'ä¾¡æ ¼ã«æ•æ„Ÿãªå­¦ç”Ÿã‚„ãƒ•ã‚¡ãƒŸãƒªãƒ¼ã«ã€‚', effects: { compatibility_mod: { 'T2': {'A2': 2.0}, 'T1': {'A2': 1.2} } } },
    ],
    kgis: [
        { id: 'K1', name: 'èªçŸ¥åº¦æ‹¡å¤§ (Impé‡è¦–)', icon: 'ğŸ“¢', desc: 'ã¨ã«ã‹ãå¤šãã®äººã«è¦‹ã¦ã‚‚ã‚‰ã†' },
        { id: 'K2', name: 'ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆå‘ä¸Š (è©±é¡Œæ€§é‡è¦–)', icon: 'â¤ï¸â€ğŸ”¥', desc: 'ã„ã„ã­ã‚„ã‚³ãƒ¡ãƒ³ãƒˆã‚’å¢—ã‚„ã™' },
        { id: 'K3', name: 'ã‚µã‚¤ãƒˆé€å®¢æ•° (ã‚¯ãƒªãƒƒã‚¯æ•°é‡è¦–)', icon: 'ğŸ–±ï¸', desc: 'ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã¸ã®è¨ªå•è€…ã‚’å¢—ã‚„ã™' }
    ],
    targets: [
        { id: 'T1', name: 'Zä¸–ä»£ãƒˆãƒ¬ãƒ³ãƒ‰å¥½ãé«˜æ ¡ç”Ÿ', icon: 'ğŸ‘©â€ğŸ“', effects: { brand: 5, buzz: 10, risk: 5 }, persona: "æµè¡Œã«æ•æ„Ÿã§ã€å¸¸ã«æ–°ã—ã„æƒ…å ±ã‚’ã‚­ãƒ£ãƒƒãƒã‚¢ãƒƒãƒ—ã€‚ä¸»ãªæƒ…å ±æºã¯TikTokã¨Instagramã€‚å‹äººã¨ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é‡è¦–ã—ã€ã€Œæ˜ ãˆã€ã‚„ã€Œã‚¨ãƒ¢ã„ã€ä½“é¨“ã‚’SNSã§ã‚·ã‚§ã‚¢ã™ã‚‹ã“ã¨ã«ä¾¡å€¤ã‚’æ„Ÿã˜ã‚‹ã€‚å‹•ç”»ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å¥½ã¿ã€é•·æ–‡ã¯ã‚ã¾ã‚Šèª­ã¾ãªã„å‚¾å‘ã€‚" },
        { id: 'T2', name: 'ã‚³ã‚¹ãƒ‘é‡è¦–ã®å¤§å­¦ç”Ÿ', icon: 'ğŸ’‘', effects: { brand: 5, buzz: 3, risk: 1 }, persona: "ã‚µãƒ¼ã‚¯ãƒ«ã‚„ãƒã‚¤ãƒˆã§å¤šå¿™ãªæ—¥ã€…ã€‚è³¢ããŠé‡‘ã‚’ä½¿ã„ãŸã„ã¨è€ƒãˆã¦ãŠã‚Šã€ã‚¯ãƒ¼ãƒãƒ³ã‚„ã‚»ãƒ¼ãƒ«æƒ…å ±ã«æ•æ„Ÿã€‚X(æ—§Twitter)ã‚„ã¾ã¨ã‚ã‚µã‚¤ãƒˆã§æƒ…å ±åé›†ã™ã‚‹ã“ã¨ãŒå¤šã„ã€‚å‹äººã‹ã‚‰ã®ã€Œå£ã‚³ãƒŸã€ã‚„ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ä¿¡é ¼ã™ã‚‹ã€‚" },
        { id: 'T3', name: 'æƒ…å ±æ„Ÿåº¦ã®é«˜ã„å­è‚²ã¦ãƒãƒ', icon: 'ğŸ‘©â€ğŸ‘§â€ğŸ‘¦', effects: { brand: 10, buzz: 5, risk: 3 }, persona: "å­ä¾›ã®ãŸã‚ã«ã€å®‰å¿ƒãƒ»å®‰å…¨ãªã‚‚ã®ã‚’é¸ã³ãŸã„ã€‚ãƒãƒå‹ã¨ã®LINEã‚°ãƒ«ãƒ¼ãƒ—ã‚„Instagramã®å°‚é–€å®¶ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒä¸»ãªæƒ…å ±æºã€‚æ™‚çŸ­ã‚„ä¾¿åˆ©ã‚°ãƒƒã‚ºã«é–¢å¿ƒãŒé«˜ã„ã€‚ã€Œå°‚é–€å®¶ã®ãŠã™ã™ã‚ã€ã‚„ã€ŒåŒã˜æ‚©ã¿ã‚’æŠ±ãˆã‚‹äººã®ä½“é¨“è«‡ã€ã«å¼·ãæƒ¹ã‹ã‚Œã‚‹ã€‚" },
        { id: 'T4', name: 'æ¨ã—æ´»ã«å…¨åŠ›ãªã‚ªã‚¿ã‚¯å¥³å­', icon: 'ğŸ’–', effects: { brand: 3, buzz: 15, risk: 8 }, persona: "å¥½ããªã‚¢ãƒ‹ãƒ¡ã‚„ã‚¢ã‚¤ãƒ‰ãƒ«ã®ãŸã‚ãªã‚‰æ™‚é–“ã‚‚ãŠé‡‘ã‚‚æƒœã—ã¾ãªã„ã€‚X(æ—§Twitter)ã«å¸¸é§ã—ã€åŒã˜è¶£å‘³ã®ä»²é–“ã¨ã®äº¤æµã‚’æœ€ã‚‚å¤§åˆ‡ã«ã™ã‚‹ã€‚å…¬å¼ã‹ã‚‰ã®ä¾›çµ¦ã ã‘ã§ãªãã€ãƒ•ã‚¡ãƒ³åŒå£«ã§ä½œã‚Šå‡ºã™ã‚³ãƒ³ãƒ†ãƒ³ãƒ„(äºŒæ¬¡å‰µä½œãªã©)ã«ã‚‚ç©æ¥µçš„ã€‚ã€Œæ¨ã—ã€ã¨é–¢é€£ä»˜ã‘ã‚‰ã‚Œã‚‹ä¼ç”»ã«ã¯é©šç•°çš„ãªç†±é‡ã§å‚åŠ ã™ã‚‹ã€‚" },
        { id: 'T5', name: 'å¥åº·å¿—å‘ã®ã‚·ãƒ‹ã‚¢å±¤', icon: 'ğŸ‘µ', effects: { brand: 15, buzz: 1, risk: 1 }, persona: "æ–°èã‚„ãƒ†ãƒ¬ãƒ“ã€LINEã§ã®å®¶æ—ã¨ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒä¸­å¿ƒã€‚å¥åº·ã‚„å­«ã€è¶£å‘³ã«é–¢ã™ã‚‹è©±é¡Œã«é–¢å¿ƒãŒé«˜ã„ã€‚ä¿¡é ¼ã§ãã‚‹æƒ…å ±æºã‹ã‚‰ã®æ¨å¥¨ã‚’é‡è¦–ã—ã€æ´¾æ‰‹ãªåºƒå‘Šã‚ˆã‚Šã‚‚ã€ä¸å¯§ã§èª å®Ÿãªèª¬æ˜ã‚’å¥½ã‚€ã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã®è¤‡é›‘ãªæ“ä½œã¯è‹¦æ‰‹ã€‚" }
    ],
    appeals: [
        { id: 'A1', name: 'æ˜ ãˆ', icon: 'ğŸ“¸', effects: { brand: 5, buzz: 10, risk: 2 }, keywords: ["æ˜ ãˆ", "ã‚¨ãƒ¢ã„", "ãŠã—ã‚ƒã‚Œ", "å¯æ„›ã„"] },
        { id: 'A2', name: 'ã‚³ã‚¹ãƒ‘', icon: 'ğŸ’°', effects: { brand: 3, buzz: 3, risk: 1 }, keywords: ["ã‚³ã‚¹ãƒ‘", "ãŠå¾—", "ã‚»ãƒ¼ãƒ«", "å®‰ã„", "ã‚¯ãƒ¼ãƒãƒ³"] },
        { id: 'A3', name: 'ã‚¿ã‚¤ãƒ‘', icon: 'â±ï¸', effects: { brand: 2, buzz: 5, risk: 1 }, keywords: ["ã‚¿ã‚¤ãƒ‘", "æ™‚çŸ­", "åŠ¹ç‡", "ã™ã", "ç°¡å˜"] },
        { id: 'A4', name: 'å®‰å¿ƒæ„Ÿ', icon: 'ğŸ›¡ï¸', effects: { brand: 10, buzz: 1, risk: 0 }, keywords: ["å®‰å¿ƒ", "å®‰å…¨", "ä¿¡é ¼", "å…¬å¼", "å“è³ª"] },
        { id: 'A5', name: 'é™å®šæ€§', icon: 'âœ¨', effects: { brand: 5, buzz: 8, risk: 3 }, keywords: ["é™å®š", "ä»Šã ã‘", "ç‰¹åˆ¥", "ãƒ¬ã‚¢"] },
        { id: 'A6', name: 'å‚åŠ å‹', icon: 'ğŸ‰', effects: { brand: 8, buzz: 10, risk: 5 }, keywords: ["å‚åŠ ", "ä½“é¨“", "ãƒãƒ£ãƒ¬ãƒ³ã‚¸", "ã¿ã‚“ãªã§"] },
        { id: 'A7', name: 'æ¨ã—æ´»', icon: 'ğŸ¤', effects: { brand: 5, buzz: 15, risk: 8 }, keywords: ["æ¨ã—", "å¿œæ´", "ç¥­å£‡", "å°Šã„", "æ‹…å½“"] }
    ],
    media: [
        { id: 'M1', name: 'Instagram', cpc: 150, effects: { brand: 5, buzz: 10, risk: 3 } },
        { id: 'M2', name: 'TikTok', cpc: 120, effects: { brand: 2, buzz: 15, risk: 8 } },
        { id: 'M3', name: 'X (æ—§Twitter)', cpc: 100, effects: { brand: 3, buzz: 12, risk: 10 } },
        { id: 'M4', name: 'LINEåºƒå‘Š', cpc: 200, effects: { brand: 8, buzz: 2, risk: 1 } },
        { id: 'M5', name: 'YouTube Shorts', cpc: 180, effects: { brand: 5, buzz: 8, risk: 5 } }
    ],
    creatives: [
        { id: 'C1', name: 'ãƒã‚¤ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ãªã‚·ãƒ§ãƒ¼ãƒˆå‹•ç”»', multiplier: 1.2, desc: 'ï¼ˆCTR 1.2å€ï¼‰', effects: { brand: -5, buzz: 15, risk: 10 } },
        { id: 'C2', name: 'æ´—ç·´ã•ã‚ŒãŸå†™çœŸãƒ»ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯', multiplier: 1.0, desc: 'ï¼ˆCTR 1.0å€ï¼‰', effects: { brand: 10, buzz: 5, risk: 2 } },
        { id: 'C3', name: 'ä¸å¯§ãªé•·å°ºèª¬æ˜å‹•ç”»', multiplier: 0.8, desc: 'ï¼ˆCTR 0.8å€ï¼‰', effects: { brand: 15, buzz: 2, risk: 1 } }
    ],
    influencers: [
        { id: 'I0', name: 'èµ·ç”¨ã—ãªã„', cost: 0, effects: { ctrMultiplier: 1.0, buzz: 0, risk: 0 }, desc: "ã‚³ã‚¹ãƒˆã‚’ã‹ã‘ãšè‡ªåŠ›ã§é ‘å¼µã‚‹" },
        { id: 'I1', name: 'æ–°äººãƒˆãƒ¬ãƒ³ãƒ‰ç³»', cost: 100000, effects: { ctrMultiplier: 1.1, buzz: 10, risk: 5 }, desc: "ã‚³ã‚¹ãƒˆã¯ä½ã„ãŒå½±éŸ¿åŠ›ã¯æœªçŸ¥æ•°" },
        { id: 'I2', name: 'ä¸­å …ãŠã‚‚ã—ã‚ç³»', cost: 300000, effects: { ctrMultiplier: 1.3, buzz: 20, risk: 15 }, desc: "ãƒã‚ºã‚‹å¯èƒ½æ€§ã¯ã‚ã‚‹ãŒç‚ä¸Šãƒªã‚¹ã‚¯ã‚‚" },
        { id: 'I3', name: 'å¤§å¾¡æ‰€å®‰å¿ƒç³»', cost: 500000, effects: { ctrMultiplier: 1.2, buzz: 5, risk: -5 }, desc: "å½±éŸ¿åŠ›ã¯çµ¶å¤§ã§ä¿¡é ¼æ€§ã‚‚é«˜ã„ãŒé«˜ã‚³ã‚¹ãƒˆ" }
    ],
    incentives: [
        { id: 'N0', name: 'ã‚¤ãƒ³ã‚»ãƒ³ãƒ†ã‚£ãƒ–ãªã—', cost: 0, effects: { buzz: -10, brand: -5 }, desc: "æ™¯å“ãªã—ã§å‚åŠ ã‚’å‘¼ã³ã‹ã‘ã‚‹" },
        { id: 'N1', name: 'ãƒ‡ã‚¸ã‚¿ãƒ«ã‚¯ãƒ¼ãƒãƒ³1000å', cost: 50000, effects: { buzz: 10, brand: 5 }, desc: "ä½ã‚³ã‚¹ãƒˆã§å¤šãã®äººãŒå‚åŠ ã—ã‚„ã™ã„" },
        { id: 'N2', name: 'ã‚®ãƒ•ãƒˆåˆ¸100å', cost: 100000, effects: { buzz: 15, brand: 10 }, desc: "å¤šãã®äººã«å–œã°ã‚Œã‚‹ãƒãƒ©ãƒ³ã‚¹å‹" },
        { id: 'N3', name: 'è±ªè¯æ™¯å“1å', cost: 200000, effects: { buzz: 25, brand: 15 }, desc: "å¤§ããªè©±é¡Œã«ãªã‚‹ãŒã€å‚åŠ è€…ã¯é™ã‚‰ã‚Œã‚‹" }
    ],
    compatibility: {
        'T1': { 'A1': 2.0, 'A3': 1.5, 'A6': 1.5, 'A7': 1.2, 'A2': 1.0, 'A5': 1.0, 'A4': 0.5 },
        'T2': { 'A2': 2.0, 'A5': 1.5, 'A3': 1.2, 'A1': 1.0, 'A6': 1.0, 'A4': 0.8, 'A7': 0.2 },
        'T3': { 'A4': 2.0, 'A2': 1.8, 'A3': 1.5, 'A6': 0.8, 'A5': 0.5, 'A1': 0.2, 'A7': 0.1 },
        'T4': { 'A7': 2.0, 'A6': 1.8, 'A5': 1.5, 'A1': 1.2, 'A2': 0.5, 'A3': 0.2, 'A4': 0.1 },
        'T5': { 'A4': 2.0, 'A2': 1.2, 'A5': 0.5, 'A3': 0.2, 'A1': 0.1, 'A6': 0.1, 'A7': 0.1 },
    },
    reviews: {
        'T1': { q: "ä¸Šé•·ã€Œã“ã®ä¼ç”»ã€æœ¬å½“ã«é«˜æ ¡ç”Ÿã«ã‚¦ã‚±ã‚‹ã®ã‹ï¼Ÿã‚‚ã£ã¨ç›´æ¥çš„ãªã€ãŠå¾—æ„Ÿã€ã‚’å‡ºã™ã¹ãã§ã¯ï¼Ÿã€", o: ["ç¾åœ¨ã®é«˜æ ¡ç”Ÿã¯ã€é‡‘éŠ­çš„ãªãŠå¾—æ„Ÿã‚ˆã‚Šã‚‚SNSã§å…±æœ‰ã§ãã‚‹ã€ä½“é¨“ä¾¡å€¤ã€ã‚’é‡è¦–ã™ã‚‹ãŸã‚ã€ã“ã®è¨´æ±‚ãŒæœ‰åŠ¹ã§ã™ã€‚", "ã¯ã„ã€ãŠå¾—æ„Ÿã‚‚é‡è¦ãªã®ã§ã€ãã¡ã‚‰ã‚‚è¿½åŠ ã—ã¾ã™ã€‚", "ãƒ‡ãƒ¼ã‚¿ãŒãªã„ã®ã§ä½•ã¨ã‚‚è¨€ãˆã¾ã›ã‚“ãŒã€ã‚„ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚"], a: "ç¾åœ¨ã®é«˜æ ¡ç”Ÿã¯ã€é‡‘éŠ­çš„ãªãŠå¾—æ„Ÿã‚ˆã‚Šã‚‚SNSã§å…±æœ‰ã§ãã‚‹ã€ä½“é¨“ä¾¡å€¤ã€ã‚’é‡è¦–ã™ã‚‹ãŸã‚ã€ã“ã®è¨´æ±‚ãŒæœ‰åŠ¹ã§ã™ã€‚", trustEffect: { correct: 10, wrong: -40 } },
        'T2': { q: "ä¸Šé•·ã€Œã‚³ã‚¹ãƒ‘è¨´æ±‚ã¯è‰¯ã„ãŒã€å®‰ã£ã½ã„ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒä»˜ã‹ãªã„ã‹å¿ƒé…ã ã€‚ã€", o: ["ä¾¡æ ¼ã ã‘ã§ãªãã€å“è³ªã‚‚ä¼´ã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¤ºã™ã“ã¨ã§ã€è³¢ã„é¸æŠã€ã ã¨æ„Ÿã˜ã•ã›ã€å®‰ã£ã½ã•ã‚’æ‰•æ‹­ã—ã¾ã™ã€‚", "ç¢ºã‹ã«å®‰ã£ã½ã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ãƒªã‚¹ã‚¯ã§ã™ãŒã€å£²ä¸Šã®ãŸã‚ã«ã¯ä»•æ–¹ã‚ã‚Šã¾ã›ã‚“ã€‚", "ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚ˆã‚Šã‚‚ã¾ãšã€ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚ã‚‰ã†ã“ã¨ãŒé‡è¦ã§ã™ã€‚"], a: "ä¾¡æ ¼ã ã‘ã§ãªãã€å“è³ªã‚‚ä¼´ã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¤ºã™ã“ã¨ã§ã€è³¢ã„é¸æŠã€ã ã¨æ„Ÿã˜ã•ã›ã€å®‰ã£ã½ã•ã‚’æ‰•æ‹­ã—ã¾ã™ã€‚", trustEffect: { correct: 10, wrong: -40 } },
        'T3': { q: "ä¸Šé•·ã€Œå­è‚²ã¦ãƒãƒå‘ã‘ãªã‚‰ã€ã‚‚ã£ã¨æ¥½ã—ãã†ãªä¼ç”»ãŒè‰¯ã„ã®ã§ã¯ï¼Ÿã€å®‰å¿ƒæ„Ÿã€ã ã‘ã ã¨åœ°å‘³ã˜ã‚ƒãªã„ã‹ï¼Ÿã€", o: ["å­è‚²ã¦ä¸­ã®ãƒãƒã¯ä½•ã‚ˆã‚Šã‚‚å­ä¾›ã®å®‰å…¨ã‚’å„ªå…ˆã—ã¾ã™ã€‚æ¥½ã—ã•ã‚ˆã‚Šã‚‚ã¾ãšã€ä¿¡é ¼ã€ã‚’å‹ã¡å–ã‚‹ã“ã¨ãŒè³¼è²·ã¸ã®ç¬¬ä¸€æ­©ã§ã™ã€‚", "ã§ã¯ã€ã‚‚ã£ã¨æ¥½ã—ãã†ãªè¨´æ±‚ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚", "åœ°å‘³ãªæ–¹ãŒèª å®Ÿã•ãŒä¼ã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚"], a: "å­è‚²ã¦ä¸­ã®ãƒãƒã¯ä½•ã‚ˆã‚Šã‚‚å­ä¾›ã®å®‰å…¨ã‚’å„ªå…ˆã—ã¾ã™ã€‚æ¥½ã—ã•ã‚ˆã‚Šã‚‚ã¾ãšã€ä¿¡é ¼ã€ã‚’å‹ã¡å–ã‚‹ã“ã¨ãŒè³¼è²·ã¸ã®ç¬¬ä¸€æ­©ã§ã™ã€‚", trustEffect: { correct: 10, wrong: -40 } },
        'T4': { q: "ä¸Šé•·ã€Œã€æ¨ã—æ´»ã€ã¯ä¸€éƒ¨ã®äººã«ã—ã‹éŸ¿ã‹ãªã„ãƒ‹ãƒƒãƒãªä¼ç”»ã ã€‚ã‚‚ã£ã¨ãƒã‚¹å‘ã‘ã«ã™ã¹ãã§ã¯ï¼Ÿã€", o: ["ãƒ‹ãƒƒãƒã ã‹ã‚‰ã“ãã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«æ·±ãåˆºã•ã‚Šã€ç†±ç‹‚çš„ãªUGCã‚’ç”Ÿã¿å‡ºã—ã¾ã™ã€‚ãƒã‚¹å‘ã‘åºƒå‘Šã‚ˆã‚Šé«˜ã„ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆãŒæœŸå¾…ã§ãã¾ã™ã€‚", "ç¢ºã‹ã«ãƒ‹ãƒƒãƒã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’åºƒã’ã¾ã™ã€‚", "ãƒã‚¹å‘ã‘ã¯ã™ã§ã«ä»–ç¤¾ãŒã‚„ã£ã¦ã„ã‚‹ã®ã§ã€å·®åˆ¥åŒ–ã®ãŸã‚ã§ã™ã€‚"], a: "ãƒ‹ãƒƒãƒã ã‹ã‚‰ã“ãã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«æ·±ãåˆºã•ã‚Šã€ç†±ç‹‚çš„ãªUGCã‚’ç”Ÿã¿å‡ºã—ã¾ã™ã€‚ãƒã‚¹å‘ã‘åºƒå‘Šã‚ˆã‚Šé«˜ã„ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆãŒæœŸå¾…ã§ãã¾ã™ã€‚", trustEffect: { correct: 10, wrong: -40 } },
        'T5': { q: "ä¸Šé•·ã€Œã‚·ãƒ‹ã‚¢å‘ã‘ã«SNSåºƒå‘Šã¯æœ¬å½“ã«å±Šãã®ã‹ï¼Ÿãƒ†ãƒ¬ãƒ“CMã®æ–¹ãŒç¢ºå®Ÿã˜ã‚ƒãªã„ã‹ï¼Ÿã€", o: ["è¿‘å¹´ã¯ã‚·ãƒ‹ã‚¢å±¤ã®SNSåˆ©ç”¨ã‚‚å¢—åŠ ã—ã¦ãŠã‚Šã€ç‰¹ã«LINEã¯é‡è¦ãªæƒ…å ±æºã§ã™ã€‚ãƒ†ãƒ¬ãƒ“ã‚ˆã‚Šä½ã‚³ã‚¹ãƒˆã§ã€åŠ¹æœæ¸¬å®šã‚‚å¯èƒ½ã§ã™ã€‚", "SNSãŒé§„ç›®ãªã‚‰ãƒ†ãƒ¬ãƒ“CMã«åˆ‡ã‚Šæ›¿ãˆã‚‹ãƒ—ãƒ©ãƒ³ã‚‚ç”¨æ„ã—ã¾ã™ã€‚", "ã¨ã«ã‹ãæ–°ã—ã„ã“ã¨ã«æŒ‘æˆ¦ã™ã‚‹ã¹ãã§ã™ã€‚"], a: "è¿‘å¹´ã¯ã‚·ãƒ‹ã‚¢å±¤ã®SNSåˆ©ç”¨ã‚‚å¢—åŠ ã—ã¦ãŠã‚Šã€ç‰¹ã«LINEã¯é‡è¦ãªæƒ…å ±æºã§ã™ã€‚ãƒ†ãƒ¬ãƒ“ã‚ˆã‚Šä½ã‚³ã‚¹ãƒˆã§ã€åŠ¹æœæ¸¬å®šã‚‚å¯èƒ½ã§ã™ã€‚", trustEffect: { correct: 10, wrong: -40 } },
    },
    ctrTable: {'T1':{'A1':{'M1':2.5,'M2':3,'M3':1.5,'M4':.8,'M5':2.8},'A2':{'M1':1,'M2':1.5,'M3':1.8,'M4':1.2,'M5':1.2},'A3':{'M1':1.8,'M2':2.2,'M3':1.2,'M4':.7,'M5':2.5},'A6':{'M1':2,'M2':2.5,'M3':2.2,'M4':1,'M5':2.3},'A7':{'M1':2.8,'M2':3.2,'M3':3.5,'M4':1.5,'M5':3}},'T2':{'A1':{'M1':2.2,'M2':1.8,'M3':1,'M4':.9,'M5':1.5},'A2':{'M1':2.5,'M2':2,'M3':2.2,'M4':1.8,'M5':1.8},'A5':{'M1':1.8,'M2':1.5,'M3':1.2,'M4':1,'M5':1.6}},'T3':{'A2':{'M1':2,'M2':1.2,'M3':1.8,'M4':2.5,'M5':1},'A3':{'M1':1.5,'M2':1.8,'M3':1.3,'M4':2.2,'M5':1.6},'A4':{'M1':1.8,'M2':1,'M3':2,'M4':3,'M5':.8}},'T4':{'A1':{'M1':2.8,'M2':2,'M3':3,'M4':1,'M5':2.2},'A5':{'M1':2.5,'M2':1.8,'M3':2.8,'M4':1.2,'M5':2},'A6':{'M1':2.2,'M2':2.5,'M3':3.2,'M4':1.5,'M5':2.6},'A7':{'M1':3.5,'M2':3,'M3':4,'M4':1.8,'M5':3.2}},'T5':{'A2':{'M1':.8,'M2':.5,'M3':1.2,'M4':2,'M5':.6},'A4':{'M1':1,'M2':.6,'M3':1.5,'M4':2.5,'M5':.7}}},
    events: [
        { title: "ãƒã‚¸ãƒ†ã‚£ãƒ–ã‚¤ãƒ™ãƒ³ãƒˆ", icon: "ğŸŒŸ", description: "æœ‰åã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ãŒå•†å“ã‚’ç´¹ä»‹ï¼è©±é¡Œæ€§ãŒå¤§å¹…ã«ã‚¢ãƒƒãƒ—ã—ã€CTRãŒ1.2å€ã«ãªã‚Šã¾ã™ã€‚", effects: { ctrMultiplier: 1.2, brand: 10, buzz: 20, risk: 0 } },
        { title: "ãƒã‚¸ãƒ†ã‚£ãƒ–ã‚¤ãƒ™ãƒ³ãƒˆ", icon: "ğŸ‘", description: "ãƒ¦ãƒ¼ã‚¶ãƒ¼æŠ•ç¨¿ãŒãƒ¡ãƒ‡ã‚£ã‚¢ã«å–ã‚Šä¸Šã’ã‚‰ã‚ŒãŸï¼ãƒ–ãƒ©ãƒ³ãƒ‰å¥½æ„Ÿåº¦ã¨è©±é¡Œæ€§ãŒã‚¢ãƒƒãƒ—ã—ã¾ã™ã€‚", effects: { ctrMultiplier: 1.0, brand: 15, buzz: 15, risk: 0 } },
        { title: "ç«¶åˆã®å‹•å‘", icon: "ğŸ˜¥", description: "ç«¶åˆãŒå¤§å‹ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’é–‹å§‹â€¦ï¼ã‚¯ãƒªãƒƒã‚¯å˜ä¾¡(CPC)ãŒ1.2å€ã«ä¸Šæ˜‡ã—ã¾ã™ã€‚", effects: { cpcMultiplier: 1.2, brand: 0, buzz: -5, risk: 0 } },
        { title: "ç‚ä¸Šã‚¤ãƒ™ãƒ³ãƒˆ", icon: "ğŸ”¥", description: "ä¸é©åˆ‡ãªä¼ç”»ãŒç‚ä¸Šâ€¦ï¼ãƒ–ãƒ©ãƒ³ãƒ‰å¥½æ„Ÿåº¦ãŒå¤§å¹…ã«ä½ä¸‹ã—ã€åºƒå‘ŠãŒåœæ­¢ã•ã‚Œã¾ã—ãŸã€‚", effects: { ctrMultiplier: 0.1, brand: -30, buzz: 10, risk: 20 } },
        { title: "ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ å¤‰æ›´", icon: "ğŸ¤–", description: "SNSã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒå¤‰æ›´ã€‚ImpãŒ20%æ¸›å°‘ã—ã¾ã™ã€‚", effects: { impMultiplier: 0.8, brand: 0, buzz: -10, risk: 0 } }
    ],
    badges: [
        { id: 'b01', name: "ãƒã‚ºã®é­”è¡“å¸«", icon: "ğŸ§™â€â™‚ï¸", condition: (res) => res.buzz >= 100 },
        { id: 'b02', name: "æ„›ã•ã‚Œãƒ–ãƒ©ãƒ³ãƒ‰å¤§è³", icon: "ğŸ†", condition: (res) => res.brand >= 100 },
        { id: 'b03', name: "ç‚ä¸Šã‚¦ã‚©ãƒƒãƒãƒ£ãƒ¼", icon: "ğŸ‘¨â€ğŸš’", condition: (res) => res.risk >= 50 },
        { id: 'b04', name: "ã‚³ã‚¹ãƒ‘ã®ç¥", icon: "ğŸ’°", condition: (res) => res.avgCpc <= 120 && res.totalClicks > 6000 },
        { id: 'b05', name: "ãƒŸãƒªã‚ªãƒ³ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³", icon: "ğŸ“¢", condition: (res) => res.totalImp >= 1000000 },
        { id: 'b06', name: "å …å®Ÿãƒãƒ¼ã‚±ã‚¿ãƒ¼", icon: "ğŸ“ˆ", condition: (res) => res.risk < 10 && res.brand > 60 },
        { id: 'b07', name: "ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆãƒ—ãƒ©ãƒ³ãƒŠãƒ¼", icon: "ğŸ“", condition: (res) => res.quizCorrectCount === res.quizTotalCount && res.quizTotalCount > 0 }
    ]
};

// --- çŠ¶æ…‹ç®¡ç† ---
let currentStep = 0;
let userSelection = {};
let gameState = {};
let previousResult = null;
const TOTAL_STEPS = 13;

// --- DOMè¦ç´  ---
const progressBar = document.getElementById('progress-bar');
const trustBar = document.getElementById('trust-bar');
const trustValue = document.getElementById('trust-value');
const stepCounter = document.getElementById('step-counter');
const steps = Array.from({length: TOTAL_STEPS}, (_, i) => document.getElementById(`step-${i}`));

// --- åˆæœŸåŒ–å‡¦ç† ---
document.addEventListener('DOMContentLoaded', () => {
    initGame();
});

function initGame() {
    displayPreviousResult();

    currentStep = 0;
    userSelection = {
        product: 'P2', // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå•†å“
        kgi: null, target: null, appeals: [], media: [], budgets: {}, creative: null,
        influencer: 'I0', incentive: 'N0',
        ugc: { hashtag: '', catchphrase: '' },
    };
    gameState = {
        trust: 100,
        brand: 50, buzz: 50, risk: 10,
        ctrMultiplier: 1.0, cpcMultiplier: 1.0, impMultiplier: 1.0,
        eventLog: [],
        compatibilityScore: 1.0,
        remainingBudget: 1000000
    };
    // å„ã‚¹ãƒ†ãƒƒãƒ—ã®åˆæœŸåŒ–
    [initStep0, initStep1, initStep2, initStep3, initStep4, initStep5, initStep6, initStep7, initStep8, initStep9, initStep10, initStep11].forEach(f => f());
    
    document.getElementById('game-over-modal').classList.add('hidden', 'opacity-0');
    document.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => input.checked = false);
    document.querySelectorAll('input[type="text"]').forEach(input => input.value = '');
    
    steps.forEach((step, index) => {
        if (step) {
            if (index === 0) {
                step.classList.remove('hidden-step');
            } else {
                step.classList.add('hidden-step');
            }
        }
    });
    
    updateProgress();
}

function displayPreviousResult() {
    const container = document.getElementById('previous-result-container');
    if (!container) return;

    if (previousResult) {
        const successClass = previousResult.success ? 'border-green-500' : 'border-red-500';
        const titleClass = previousResult.success ? 'text-green-600' : 'text-red-600';
        container.innerHTML = `
            <div class="border-l-4 ${successClass} bg-gray-50 p-4 rounded-lg space-y-2">
                <h3 class="font-bold text-lg ${titleClass}">å‰å›ã®çµæœï¼š${previousResult.title}</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white text-sm">
                        <thead class="bg-gray-200">
                            <tr><th>æŒ‡æ¨™</th><th>ç›®æ¨™</th><th>çµæœ</th><th>é”æˆåº¦</th></tr>
                        </thead>
                        <tbody>${previousResult.kpiTableHTML}</tbody>
                    </table>
                </div>
            </div>
        `;
    } else {
        container.innerHTML = '';
    }
}

function createOptionHTML(type, item, groupName, customClass = '') {
    const isRadio = type === 'radio';
    const inputId = `${groupName}-${item.id || item.name.replace(/\s/g, '')}`;
    return `
        <div class="relative">
            <input type="${type}" id="${inputId}" name="${groupName}" value="${item.id || item.name}" class="hidden peer ${customClass}">
            <label for="${inputId}" class="block p-4 border-2 border-gray-200 rounded-lg cursor-pointer transition-all duration-200 peer-checked:border-blue-500 peer-checked:shadow-lg hover:bg-gray-50 h-full">
                <div class="flex items-center justify-between">
                    <span class="font-bold text-base">${item.icon ? item.icon + ' ' : ''}${item.name}</span>
                    ${isRadio ? 
                        `<div class="w-6 h-6 border-2 border-gray-300 rounded-full flex items-center justify-center peer-checked:bg-blue-500 peer-checked:border-blue-500"><div class="w-3 h-3 bg-white rounded-full"></div></div>` :
                        `<div class="w-6 h-6 border-2 border-gray-300 rounded-md flex items-center justify-center peer-checked:bg-blue-500 peer-checked:border-blue-500"><svg class="w-4 h-4 text-white hidden peer-checked:block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div>`
                    }
                </div>
                ${item.desc ? `<p class="text-sm text-gray-500 mt-1">${item.desc}</p>` : ''}
            </label>
        </div>
    `;
}

function initStep0(){
    const productContainer = document.getElementById('product-options');
    productContainer.innerHTML = gameData.products.map(p => createOptionHTML('radio', p, 'product')).join('');
    productContainer.addEventListener('change', e => userSelection.product = e.target.value);
    document.getElementById('product-P2').checked = true; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé¸æŠ
    
    const container = document.getElementById('mission-briefing-display');
    const goals = gameData.missionGoals;
    container.innerHTML = `
        <div class="bg-gray-100 p-3 rounded-lg"><div class="font-bold">ç›®æ¨™Imp</div><div class="text-xl">${goals.imp.toLocaleString()}</div></div>
        <div class="bg-gray-100 p-3 rounded-lg"><div class="font-bold">ç›®æ¨™ã‚¯ãƒªãƒƒã‚¯æ•°</div><div class="text-xl">${goals.clicks.toLocaleString()}</div></div>
        <div class="bg-gray-100 p-3 rounded-lg"><div class="font-bold">ç›®æ¨™CTR</div><div class="text-xl">${goals.ctr}% ä»¥ä¸Š</div></div>
        <div class="bg-gray-100 p-3 rounded-lg"><div class="font-bold">ç›®æ¨™CPC</div><div class="text-xl">${goals.cpc.toLocaleString()}å†† ä»¥ä¸‹</div></div>
    `;
    const topDisplay = document.getElementById('mission-goals-display');
    topDisplay.innerHTML = `
        <div class="bg-gray-50 p-1 rounded-lg">ç›®æ¨™Imp: <b>${goals.imp.toLocaleString()}</b></div>
        <div class="bg-gray-50 p-1 rounded-lg">ç›®æ¨™Click: <b>${goals.clicks.toLocaleString()}</b></div>
        <div class="bg-gray-50 p-1 rounded-lg">ç›®æ¨™CTR: <b>${goals.ctr}%</b></div>
        <div class="bg-gray-50 p-1 rounded-lg">ç›®æ¨™CPC: <b>${goals.cpc}å††</b></div>
    `;
}
function initStep1(){const c=document.getElementById("kgi-options");c.innerHTML=gameData.kgis.map(k=>createOptionHTML("radio",k,"kgi")).join(""),c.addEventListener("change",e=>userSelection.kgi=e.target.value)}
function initStep2(){const c=document.getElementById("target-options");c.innerHTML=gameData.targets.map(t=>createOptionHTML("radio",t,"target")).join(""),c.addEventListener("change",e=>userSelection.target=e.target.value)}
function initStep3(){}
function initStep4(){const c=document.getElementById("appeal-options");c.innerHTML=gameData.appeals.map(a=>createOptionHTML("checkbox",a,"appeal")).join(""),c.addEventListener("change",e=>{const t=Array.from(c.querySelectorAll("input:checked"));document.getElementById("appeal-error").classList.toggle("hidden",t.length<=2),t.length>2&&e.target.checked==!1,userSelection.appeals=Array.from(c.querySelectorAll("input:checked")).map(c=>c.value)})}
function initStep5(){}
function initStep6(){const c=document.getElementById("media-options");c.innerHTML=gameData.media.map(m=>createOptionHTML("checkbox",m,"media")).join(""),c.addEventListener("change",e=>{const t=Array.from(c.querySelectorAll("input:checked"));document.getElementById("media-error").classList.toggle("hidden",t.length<=2),t.length>2&&e.target.checked==!1,userSelection.media=Array.from(c.querySelectorAll("input:checked")).map(c=>c.value),updateBudgetAllocator()})}
function initStep7(){const c=document.getElementById("creative-options");c.innerHTML=gameData.creatives.map(c=>createOptionHTML("radio",c,"creative")).join(""),c.addEventListener("change",e=>userSelection.creative=e.target.value)}
function initStep8(){const c=document.getElementById("influencer-options");c.innerHTML=gameData.influencers.map(i=>createOptionHTML("radio",i,"influencer")).join(""),c.addEventListener("change",e=>{userSelection.influencer=e.target.value,updateRemainingBudget()})}
function initStep9(){const c=document.getElementById("incentive-options");c.innerHTML=gameData.incentives.map(i=>createOptionHTML("radio",i,"incentive")).join(""),c.addEventListener("change",e=>{userSelection.incentive=e.target.value,updateRemainingBudget()})}
function initStep10(){["hashtag","catchphrase"].forEach(i=>{document.getElementById(`ugc-${i}`).addEventListener("input",e=>{userSelection.ugc[i]=e.target.value})})}
function initStep11(){}

function populatePersona(){const e=gameData.targets.find(t=>t.id===userSelection.target),t=document.getElementById("persona-display");e?t.innerHTML=`\n        <h3 class="font-bold text-lg">${e.icon} ${e.name}</h3>\n        <p class="text-gray-700">${e.persona}</p>\n    `:t.innerHTML='<p class="text-red-500">å…ˆã«ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>'}
function populateReview(){const e=gameData.reviews[userSelection.target],t=document.getElementById("review-container");e?t.innerHTML=`\n        <div class="space-y-2">\n            <h3 class="font-bold">ä¸Šé•·ã‹ã‚‰ã®è³ªå•ï¼š</h3>\n            <p class="bg-gray-100 p-3 rounded-lg">ã€Œ${e.q}ã€</p>\n            <h3 class="font-bold">ã‚ãªãŸã®å›ç­”ï¼š</h3>\n            <div class="space-y-2" id="review-options">\n                ${e.o.map(o=>createOptionHTML("radio",{name:o},"review","quiz-option")).join("")}\n            </div>\n        </div>\n    `:t.innerHTML="<p>ã“ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«å¯¾ã™ã‚‹ãƒ¬ãƒ“ãƒ¥ãƒ¼é …ç›®ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>"}

function updateRemainingBudget() {
    const influencerCost = gameData.influencers.find(i => i.id === userSelection.influencer)?.cost || 0;
    const incentiveCost = gameData.incentives.find(i => i.id === userSelection.incentive)?.cost || 0;
    gameState.remainingBudget = 1000000 - influencerCost - incentiveCost;
    updateBudgetAllocator();
}

function updateBudgetAllocator(){
    const display = document.getElementById('remaining-budget-display');
    if(display) display.textContent = gameState.remainingBudget.toLocaleString();
    
    const allocator = document.getElementById('budget-allocator');
    const slidersContainer = document.getElementById('budget-sliders');
    allocator.classList.toggle('hidden', userSelection.media.length === 0);
    if (userSelection.media.length === 0) return;

    const maxBudget = gameState.remainingBudget;

    if (userSelection.media.length === 1) {
        const [mediaId] = userSelection.media;
        userSelection.budgets = { [mediaId]: maxBudget };
        slidersContainer.innerHTML = `<p class="font-bold text-center">${gameData.media.find(m=>m.id===mediaId).name}ã«${maxBudget.toLocaleString()}å††å…¨é¡ã‚’é…åˆ†ã—ã¾ã™ã€‚</p>`;
    } else {
        const [mediaId1, mediaId2] = userSelection.media;
        userSelection.budgets[mediaId1] = userSelection.budgets[mediaId1] || Math.floor(maxBudget / 2);
        userSelection.budgets[mediaId2] = maxBudget - userSelection.budgets[mediaId1];
        
        const media1 = gameData.media.find(m => m.id === mediaId1);
        const media2 = gameData.media.find(m => m.id === mediaId2);
        
        slidersContainer.innerHTML = `
            <div class="space-y-2">
                <div class="flex justify-between font-bold"><span>${media1.name}</span><span id="budget-value-${mediaId1}">${userSelection.budgets[mediaId1].toLocaleString()}å††</span></div>
                <input type="range" id="budget-slider" min="0" max="${maxBudget}" step="10000" value="${userSelection.budgets[mediaId1]}" class="w-full h-3 bg-gray-200 rounded-lg">
                <div class="flex justify-between font-bold"><span>${media2.name}</span><span id="budget-value-${mediaId2}">${userSelection.budgets[mediaId2].toLocaleString()}å††</span></div>
            </div>`;
        
        document.getElementById('budget-slider').addEventListener('input', e => {
            const budget1 = parseInt(e.target.value);
            userSelection.budgets[mediaId1] = budget1;
            userSelection.budgets[mediaId2] = maxBudget - budget1;
            document.getElementById(`budget-value-${mediaId1}`).textContent = `${budget1.toLocaleString()}å††`;
            document.getElementById(`budget-value-${mediaId2}`).textContent = `${(maxBudget - budget1).toLocaleString()}å††`;
            updateTotalBudget();
        });
    }
    updateTotalBudget();
}

function updateTotalBudget(){
    const total = Object.values(userSelection.budgets).reduce((s,c)=>s+c,0);
    const errorEl = document.getElementById('budget-error');
    document.getElementById('total-budget').textContent = total.toLocaleString();
    errorEl.classList.toggle('hidden', total === gameState.remainingBudget);
    errorEl.textContent = `åˆè¨ˆäºˆç®—ã‚’${gameState.remainingBudget.toLocaleString()}å††ã«ã—ã¦ãã ã•ã„ã€‚`;
}

function updateProgress(){const e=currentStep/(TOTAL_STEPS-2)*100;progressBar.style.width=`${e}%`,stepCounter.textContent=`ã‚¹ãƒ†ãƒƒãƒ— ${currentStep} / ${TOTAL_STEPS-2}`;const t=gameState.trust;trustBar.style.width=`${t}%`,trustValue.textContent=`${t.toFixed(0)}%`,trustBar.classList.toggle("bg-green-500",t>60),trustBar.classList.toggle("bg-yellow-500",t<=60&&t>20),trustBar.classList.toggle("bg-red-500",t<=20)}

function switchStep(from, to, force = false) {
    if (!force) {
        calculateHiddenParams();
        if (checkGameOver("ä¿¡é ¼åº¦ãŒä½ä¸‹ã—ã™ãã¾ã—ãŸã€‚")) return;
    }
    if(steps[from]) steps[from].classList.add('hidden-step');
    if(steps[to]) steps[to].classList.remove('hidden-step');
    currentStep = to;
    updateProgress();
    window.scrollTo(0, 0);

    // å‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ç”Ÿæˆ
    if (to === 4) populatePersona();
    if (to === 6) populateReview();
}

function prevStep(targetStep){switchStep(currentStep,targetStep,!0)}
function nextStep(targetStep){if(!validateStep(currentStep))return;gameState.forcedEvent?(triggerRandomEvent(targetStep,gameState.forcedEvent),gameState.forcedEvent=null):[7,8].includes(currentStep)&&.5>Math.random()?triggerRandomEvent(targetStep):switchStep(currentStep,targetStep)}

function checkReview(){const e=gameData.reviews[userSelection.target],t=document.getElementById("review-error");if(!e)return void switchStep(currentStep,7);const s=document.querySelector('input[name="review"]:checked');s?(t.classList.add("hidden"),s.value===e.a?(gameState.trust+=e.trustEffect.correct,alert("ç´ æ™´ã‚‰ã—ã„å›ç­”ã§ã™ï¼ä¸Šé•·ã¯ç´å¾—ã—ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®ä¿¡é ¼ãŒä¸ŠãŒã‚Šã¾ã—ãŸã€‚")):(gameState.trust+=e.trustEffect.wrong,alert("ãã®å›ç­”ã§ã¯ä¸Šé•·ã¯ç´å¾—ã—ãªã„ã§ã—ã‚‡ã†â€¦ä¿¡é ¼åº¦ãŒä½ä¸‹ã—ã¾ã—ãŸã€‚")),switchStep(currentStep,7)):(t.textContent="å›ç­”ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚",t.classList.remove("hidden"))}

function triggerRandomEvent(nextStepAfter, forceEvent) {
    const event = forceEvent || gameData.events[Math.floor(Math.random() * gameData.events.length)];
    if (event.title === "ç‚ä¸Šã‚¤ãƒ™ãƒ³ãƒˆ" && gameState.eventLog.some(e => e.title === "ç‚ä¸Šã‚¤ãƒ™ãƒ³ãƒˆ")) {
       if (nextStepAfter !== null) switchStep(currentStep, nextStepAfter);
       return;
    }
    gameState.eventLog.push(event);
    for (const key in event.effects) {
        if (key.includes('Multiplier')) gameState[key] *= event.effects[key];
        else gameState[key] += event.effects[key];
    }
    document.getElementById('event-title').textContent = event.title;
    document.getElementById('event-icon').textContent = event.icon;
    document.getElementById('event-description').textContent = event.description;
    const modal = document.getElementById('event-modal');
    const modalContent = modal.querySelector('.modal-content');
    modal.dataset.nextStep = nextStepAfter;
    modal.classList.remove('hidden');
    setTimeout(() => {
        modal.classList.add('opacity-100');
        if (modalContent) modalContent.classList.add('scale-100');
    }, 10);
}

function closeEventModal() {
    const modal = document.getElementById('event-modal');
    const modalContent = modal.querySelector('.modal-content');
    const nextStepAfter = modal.dataset.nextStep;
    modal.classList.remove('opacity-100');
    if (modalContent) {
        modalContent.classList.remove('scale-100');
        modalContent.classList.add('scale-95');
    }
    setTimeout(() => {
        modal.classList.add('hidden');
        if (checkGameOver("ã‚¤ãƒ™ãƒ³ãƒˆã«ã‚ˆã‚Šãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒå±æ©Ÿã«ç€•ã—ã¾ã—ãŸã€‚")) return;
        if (nextStepAfter !== null) switchStep(currentStep, parseInt(nextStepAfter));
    }, 300);
}

function checkGameOver(reason) {
    if (gameState.trust <= 0) {
        const modal = document.getElementById('game-over-modal');
        const content = document.getElementById('game-over-content');
        if (!modal || !content) return true;

        document.getElementById('game-over-reason').textContent = reason;
        modal.classList.remove('hidden');
        setTimeout(() => {
            modal.classList.add('opacity-100');
            content.classList.remove('scale-95');
            content.classList.add('scale-100');
        }, 10);
        return true;
    }
    // KPIäºˆæ¸¬ãƒã‚§ãƒƒã‚¯
    if (currentStep === 8) { // ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–é¸æŠå¾Œ
        const projected = calculatePerformance(true);
        const goals = gameData.missionGoals;
        if (projected.totalImp < goals.imp * 0.5 || projected.totalClicks < goals.clicks * 0.5) {
            const modal = document.getElementById('game-over-modal');
            const content = document.getElementById('game-over-content');
            if (!modal || !content) return true;
            document.getElementById('game-over-reason').textContent = "KPIäºˆæ¸¬ãŒç›®æ¨™ã‚’å¤§å¹…ã«ä¸‹å›ã‚‹ãŸã‚ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ä¸­æ­¢ã¨ãªã‚Šã¾ã—ãŸã€‚";
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.add('opacity-100');
                content.classList.remove('scale-95');
                content.classList.add('scale-100');
            }, 10);
            return true;
        }
    }
    return false;
}

function validateStep(step) {
    let message = '';
    switch(step) {
        case 0: if (!userSelection.product) message = 'å•†å“ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚'; break;
        case 2: if (!userSelection.kgi) message = 'ç›®çš„(KGI)ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚'; break;
        case 3: if (!userSelection.target) message = 'ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚'; break;
        case 5: if (userSelection.appeals.length === 0) message = 'è¨´æ±‚è»¸ã‚’1ã¤ä»¥ä¸Šé¸æŠã—ã¦ãã ã•ã„ã€‚'; break;
        case 7:
            if (userSelection.media.length === 0) message = 'åª’ä½“ã‚’1ã¤ä»¥ä¸Šé¸æŠã—ã¦ãã ã•ã„ã€‚';
            else if (Math.abs(Object.values(userSelection.budgets).reduce((s, b) => s + b, 0) - gameState.remainingBudget) > 1) message = `åˆè¨ˆäºˆç®—ã‚’${gameState.remainingBudget.toLocaleString()}å††ã«ã—ã¦ãã ã•ã„ã€‚`;
            break;
        case 8: if (!userSelection.creative) message = 'ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚'; break;
        case 9: if (!userSelection.influencer) message = 'ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚'; break;
        case 10: if (!userSelection.incentive) message = 'ã‚¤ãƒ³ã‚»ãƒ³ãƒ†ã‚£ãƒ–ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚'; break;
        case 11: if (!userSelection.ugc.hashtag) message = 'ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'; break;
    }
    if (message) {
        alert(message);
        return false;
    }
    return true;
}

function calculateHiddenParams() {
    gameState.brand = 50; gameState.buzz = 50; gameState.risk = 10;
    const influencer = gameData.influencers.find(i => i.id === userSelection.influencer);
    const incentive = gameData.incentives.find(i => i.id === userSelection.incentive);
    
    const selections = [
        gameData.targets.find(i => i.id === userSelection.target),
        ...gameData.appeals.filter(i => userSelection.appeals.includes(i.id)),
        ...gameData.media.filter(i => userSelection.media.includes(i.id)),
        gameData.creatives.find(i => i.id === userSelection.creative),
        influencer,
        incentive
    ];
    for (const item of selections) {
        if (item && item.effects) {
            gameState.brand += item.effects.brand || 0;
            gameState.buzz += item.effects.buzz || 0;
            gameState.risk += item.effects.risk || 0;
        }
    }
    
    if (userSelection.appeals.length > 0) {
        const appealKeywords = userSelection.appeals.flatMap(id => gameData.appeals.find(a=>a.id === id)?.keywords || []);
        const ugcText = `${userSelection.ugc.hashtag} ${userSelection.ugc.catchphrase}`.toLowerCase();
        const matchCount = appealKeywords.filter(kw => ugcText.includes(kw)).length;
        gameState.buzz += matchCount * 10;
    }

    // å•†å“ã«ã‚ˆã‚‹ç›¸æ€§è£œæ­£
    const product = gameData.products.find(p => p.id === userSelection.product);
    const productCompatibilityMod = product?.effects?.compatibility_mod || {};

    if (userSelection.target && userSelection.appeals.length > 0) {
        let totalCompatibility = 0;
        userSelection.appeals.forEach(appealId => {
            let baseScore = gameData.compatibility[userSelection.target]?.[appealId] || 0.5;
            let modScore = productCompatibilityMod[userSelection.target]?.[appealId] || 1.0;
            totalCompatibility += baseScore * modScore;
        });
        gameState.compatibilityScore = totalCompatibility / userSelection.appeals.length;
    } else {
        gameState.compatibilityScore = 1.0;
    }

    if (gameState.risk > 60 && (userSelection.creative === 'C1' || userSelection.media.includes('M2') || userSelection.media.includes('M3'))) {
        if (Math.random() < 0.5) {
            const fireEvent = gameData.events.find(e => e.title === "ç‚ä¸Šã‚¤ãƒ™ãƒ³ãƒˆ");
            if (fireEvent) gameState.forcedEvent = fireEvent;
        }
    }
}

function calculatePerformance(isProjection = false) {
    if (!isProjection) calculateHiddenParams();
    
    const target = gameData.targets.find(t => t.id === userSelection.target);
    const creative = gameData.creatives.find(c => c.id === userSelection.creative);
    const influencer = gameData.influencers.find(i => i.id === userSelection.influencer);

    let totalBudget = 0, totalImp = 0, totalClicks = 0;

    if (!target || !creative || !influencer || userSelection.media.length === 0) {
        return { totalBudget, totalImp, totalClicks, avgCpc: 0 };
    }

    const influencerCtrMultiplier = influencer.effects.ctrMultiplier || 1.0;

    for (const mediaId of userSelection.media) {
        const media = gameData.media.find(m => m.id === mediaId);
        const budget = userSelection.budgets[mediaId] || 0;
        const cpc = media.cpc * gameState.cpcMultiplier;
        let bestCtr = userSelection.appeals.reduce((max, appealId) => Math.max(max, gameData.ctrTable[target.id]?.[appealId]?.[mediaId] || 0.5), 0);
        const finalCtr = bestCtr * creative.multiplier * gameState.ctrMultiplier * gameState.compatibilityScore * influencerCtrMultiplier;
        const clicks = cpc > 0 ? Math.round(budget / cpc) : 0;
        const impressions = finalCtr > 0 ? Math.round((clicks / (finalCtr / 100)) * gameState.impMultiplier) : 0;
        totalBudget += budget; totalImp += impressions; totalClicks += clicks;
    }
    const avgCpc = totalClicks > 0 ? Math.round(totalBudget / totalClicks) : 0;
    return { totalBudget, totalImp, totalClicks, avgCpc };
}


function showResults() {
    if (validateStep(11)) {
        calculateAndDisplayResults();
        switchStep(11, 12);
    }
}

function calculateAndDisplayResults() {
    if (gameState.forcedEvent) {
        triggerRandomEvent(null, gameState.forcedEvent);
        gameState.forcedEvent = null;
    }
    
    const finalPerformance = calculatePerformance();
    const { totalBudget, totalImp, totalClicks, avgCpc } = finalPerformance;

    const product = gameData.products.find(p => p.id === userSelection.product);
    const target = gameData.targets.find(t => t.id === userSelection.target);
    const kgiData = gameData.kgis.find(k => k.id === userSelection.kgi);

    document.getElementById('result-product').textContent = product ? product.name : 'ï¼ˆæœªé¸æŠï¼‰';
    document.getElementById('result-kgi').textContent = kgiData ? kgiData.name : 'ï¼ˆæœªé¸æŠï¼‰';
    document.getElementById('result-target').textContent = target ? target.name : 'ï¼ˆæœªé¸æŠï¼‰';
    document.getElementById('result-appeals').textContent = userSelection.appeals.length > 0 ? gameData.appeals.filter(a => userSelection.appeals.includes(a.id)).map(a => a.name).join(', ') : 'ï¼ˆæœªé¸æŠï¼‰';
    
    const tableBody = document.getElementById('result-table-body');
    tableBody.innerHTML = '';
    
    document.getElementById('total-result-budget').textContent = `${totalBudget.toLocaleString()}å††`;
    document.getElementById('total-result-imp').textContent = totalImp.toLocaleString();
    document.getElementById('total-result-clicks').textContent = totalClicks.toLocaleString();
    document.getElementById('total-result-cpc').textContent = `${avgCpc.toLocaleString()}å††`;
    
    const kpiTable = document.getElementById('result-kpi-table');
    const goals = gameData.missionGoals;
    const results = { imp: totalImp, clicks: totalClicks, ctr: totalImp > 0 ? (totalClicks / totalImp * 100) : 0, cpc: avgCpc };
    let missionSuccess = true;

    const kpiTableHTML = `
        <tr>
            <td class="p-2 border">Imp</td>
            <td class="p-2 border">${goals.imp.toLocaleString()}</td>
            <td class="p-2 border">${results.imp.toLocaleString()}</td>
            ${renderGoalCell(results.imp, goals.imp, false)}
        </tr>
        <tr>
            <td class="p-2 border">Clicks</td>
            <td class="p-2 border">${goals.clicks.toLocaleString()}</td>
            <td class="p-2 border">${results.clicks.toLocaleString()}</td>
            ${renderGoalCell(results.clicks, goals.clicks, false)}
        </tr>
        <tr>
            <td class="p-2 border">CTR</td>
            <td class="p-2 border">${goals.ctr.toFixed(2)}%</td>
            <td class="p-2 border">${results.ctr.toFixed(2)}%</td>
            ${renderGoalCell(results.ctr, goals.ctr, false)}
        </tr>
        <tr>
            <td class="p-2 border">CPC</td>
            <td class="p-2 border">${goals.cpc.toLocaleString()}å††</td>
            <td class="p-2 border">${results.cpc.toLocaleString()}å††</td>
            ${renderGoalCell(results.cpc, goals.cpc, true)}
        </tr>
    `;
    kpiTable.innerHTML = kpiTableHTML;
    
    function renderGoalCell(result, goal, isLowerBetter) {
        if (isLowerBetter && result === 0) result = Infinity; // Handle CPC 0 case
        let success = isLowerBetter ? result <= goal : result >= goal;
        if (!success) missionSuccess = false;
        const percentage = (isLowerBetter && result !== Infinity && result > 0) ? (goal / result * 100) : (result / goal * 100);
        return `<td class="p-2 border font-bold ${success ? 'text-green-600' : 'text-red-600'}">${percentage.toFixed(0)}% ${success ? 'âœ…' : 'âŒ'}</td>`;
    }

    const resultTitleText = missionSuccess ? "ğŸ‰ãƒŸãƒƒã‚·ãƒ§ãƒ³æˆåŠŸï¼ğŸ‰" : "ãƒŸãƒƒã‚·ãƒ§ãƒ³å¤±æ•—â€¦";
    document.getElementById('result-title').textContent = resultTitleText;
    document.getElementById('result-title').className = `text-3xl font-extrabold text-center ${missionSuccess ? 'text-green-600' : 'text-red-600'}`;
    
    previousResult = {
        title: resultTitleText,
        success: missionSuccess,
        kpiTableHTML: kpiTableHTML
    };

    document.getElementById('result-brand').textContent = gameState.brand.toFixed(0);
    document.getElementById('result-buzz').textContent = gameState.buzz.toFixed(0);
    document.getElementById('result-risk').textContent = gameState.risk.toFixed(0);
    createSnsPreview();
    const eventLogList = document.getElementById('event-log-list');
    eventLogList.innerHTML = gameState.eventLog.length > 0 ? gameState.eventLog.map(e => `<li>${e.description}</li>`).join('') : '<li>ã‚¤ãƒ™ãƒ³ãƒˆã¯ç™ºç”Ÿã—ã¾ã›ã‚“ã§ã—ãŸã€‚</li>';
    const resultMetrics = { totalImp, totalClicks, avgCpc, ...gameState };
    const acquiredBadges = gameData.badges.filter(b => b.condition(resultMetrics));
    const badgeContainer = document.getElementById('badge-container');
    badgeContainer.innerHTML = acquiredBadges.length > 0 ? acquiredBadges.map(b => `<div class="bg-yellow-400 text-white font-bold py-2 px-4 rounded-full shadow-lg text-sm">${b.icon} ${b.name}</div>`).join('') : `<p class="text-sm text-gray-500">ç²å¾—ã—ãŸç§°å·ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>`;
    generateCommentary(resultMetrics);
}

function createSnsPreview() {
    const container = document.getElementById('sns-preview-container');
    const target = gameData.targets.find(t => t.id === userSelection.target);
    const media = userSelection.media.length > 0 ? gameData.media.find(m => m.id === userSelection.media[0]) : {name: 'SNS'};
    container.innerHTML = `
        <div class="flex items-center mb-2">
            <div class="w-10 h-10 rounded-full bg-blue-500 text-white flex items-center justify-center font-bold text-xl">${target ? target.icon : 'ğŸ‘¤'}</div>
            <div class="ml-3">
                <div class="font-bold">${target ? target.name : 'ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ'}</div>
                <div class="text-sm text-gray-500">Sponsored by YourBrand on ${media.name}</div>
            </div>
        </div>
        <p class="mb-2">${userSelection.ugc.catchphrase || 'ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³å®Ÿæ–½ä¸­ï¼'}</p>
        <div class="bg-gray-200 aspect-square rounded-lg mb-2 flex items-center justify-center"><p class="text-gray-500 text-lg">ï¼ˆã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ç”»åƒï¼‰</p></div>
        <p class="font-bold text-blue-600">${userSelection.ugc.hashtag || '#ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³'}</p>
    `;
}

function generateCommentary(res) {
    const commentaryContainer = document.getElementById('result-commentary');
    commentaryContainer.innerHTML = '';
    let mainResultText = '';
    const kgi = userSelection.kgi;
    if (kgi === 'K1') {
        mainResultText = res.totalImp >= gameData.missionGoals.imp ? `KGIé”æˆï¼ ${res.totalImp.toLocaleString()} Impã¯ç´ æ™´ã‚‰ã—ã„çµæœã§ã™ã€‚` : `KGIæœªé”â€¦ã€‚${res.totalImp.toLocaleString()} Impã§ã—ãŸã€‚`;
    } else if (kgi === 'K2') {
        mainResultText = res.buzz >= 100 ? `KGIé”æˆï¼ è©±é¡Œæ€§ã‚¹ã‚³ã‚¢${res.buzz.toFixed(0)}ã¯è¦‹äº‹ã§ã™ã€‚` : `KGIæœªé”â€¦ã€‚è©±é¡Œæ€§ã‚¹ã‚³ã‚¢ã¯${res.buzz.toFixed(0)}ã§ã—ãŸã€‚`;
    } else {
        mainResultText = res.totalClicks >= gameData.missionGoals.clicks ? `KGIé”æˆï¼ ${res.totalClicks.toLocaleString()} ã‚¯ãƒªãƒƒã‚¯ã¯ç´ æ™´ã‚‰ã—ã„æˆæœã§ã™ã€‚` : `KGIæœªé”â€¦ã€‚${res.totalClicks.toLocaleString()} ã‚¯ãƒªãƒƒã‚¯ã§ã—ãŸã€‚`;
    }
    commentaryContainer.innerHTML += `<p>${mainResultText}</p>`;
    let analysisText = '';
    const compatibilityScore = res.compatibilityScore;
    if (compatibilityScore >= 1.8) {
        analysisText += '<strong>åˆ†æï¼š</strong>ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¨è¨´æ±‚ã®ç›¸æ€§ãŒ<span class="text-green-600 font-bold">æ¥µã‚ã¦è‰¯å¥½</span>ã§ã—ãŸã€‚ã“ã‚ŒãŒé«˜ã„CTRã®ä¸»ãªè¦å› ã§ã™ã€‚';
    } else if (compatibilityScore >= 1.2) {
        analysisText += '<strong>åˆ†æï¼š</strong>ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¨è¨´æ±‚ã®ç›¸æ€§ã¯<span class="text-blue-600 font-bold">è‰¯å¥½</span>ã§ã™ã€‚åŸºæœ¬æˆ¦ç•¥ã¯æ­£ã—ã‹ã£ãŸã¨è¨€ãˆã‚‹ã§ã—ã‚‡ã†ã€‚';
    } else {
        analysisText += '<strong>åˆ†æï¼š</strong>ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¨è¨´æ±‚ã®ç›¸æ€§ãŒ<span class="text-red-600 font-bold">ã‚ã¾ã‚Šè‰¯ããªã‹ã£ãŸ</span>ã‚ˆã†ã§ã™ã€‚ãƒšãƒ«ã‚½ãƒŠæƒ…å ±ã‚’è¦‹ç›´ã—ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒæœ¬å½“ã«æ±‚ã‚ã¦ã„ã‚‹ã‚‚ã®ã¯ä½•ã‹ã‚’å†æ¤œè¨ã™ã‚‹ã¨ã€çµæœãŒå¤§ããæ”¹å–„ã—ã¾ã™ã€‚';
    }
     commentaryContainer.innerHTML += `<p class="mt-2">${analysisText}</p>`;
    const appealKeywords = userSelection.appeals.flatMap(id => gameData.appeals.find(a=>a.id === id)?.keywords || []);
    const ugcText = `${userSelection.ugc.hashtag} ${userSelection.ugc.catchphrase}`.toLowerCase();
    const matchCount = appealKeywords.filter(kw => ugcText.includes(kw)).length;
    if (matchCount >= 2) {
        commentaryContainer.innerHTML += `<p>UGCä¼ç”»ãŒç´ æ™´ã‚‰ã—ãã€é¸ã‚“ã è¨´æ±‚è»¸ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ã†ã¾ãåæ˜ ã§ãã¦ã„ãŸãŸã‚ã€è©±é¡Œæ€§ã‚¹ã‚³ã‚¢ãŒå¤§ããä¼¸ã³ã¾ã—ãŸï¼</p>`;
    } else {
        commentaryContainer.innerHTML += `<p>UGCä¼ç”»ãŒè¨´æ±‚è»¸ã¨å°‘ã—ã‚ºãƒ¬ã¦ã„ãŸã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ä¾‹ãˆã°ã€ã€Œ${appealKeywords.join('ã€ã‚„ã€Œ')}ã€ã¨ã„ã£ãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä¼ç”»ã«å«ã‚ã‚‹ã¨ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‚åŠ ã‚’ã‚ˆã‚Šä¿ƒã›ã¾ã™ã€‚</p>`;
    }
    if (res.risk >= 50) {
        commentaryContainer.innerHTML += '<p class="text-red-600 font-bold">ã€æ³¨æ„ã€‘ç‚ä¸Šãƒªã‚¹ã‚¯ãŒé«˜ã¾ã£ã¦ã„ã¾ã™ã€‚éæ¿€ãªè¨´æ±‚ã¯çŸ­æœŸçš„ãªè©±é¡Œã‚’ç”Ÿã¿ã¾ã™ãŒã€é•·æœŸçš„ãªãƒ–ãƒ©ãƒ³ãƒ‰ã‚¤ãƒ¡ãƒ¼ã‚¸ã«ã¯æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚</p>';
    }
}

function restartGame() {
    const gameOverModal = document.getElementById('game-over-modal');
    const content = document.getElementById('game-over-content');
    gameOverModal.classList.add('opacity-0');
    if(content) {
        content.classList.remove('scale-100');
        content.classList.add('scale-95');
    }
    setTimeout(() => {
        gameOverModal.classList.add('hidden');
    }, 500);

    initGame();
}

</script>
</body>
</html>
